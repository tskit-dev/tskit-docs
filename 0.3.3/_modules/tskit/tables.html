

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>tskit.tables &mdash; tskit 0.3.3 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> tskit
          

          
            
            <img src="../../_static/tskit_logo_pale.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                0.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python-api.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../stats.html">Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../c-api.html">C API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cli.html">Command line interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data-model.html">Data model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../metadata.html">Metadata</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../combinatorics.html">Combinatorics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../provenance.html">Provenance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development.html">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelogs.html">Changelogs</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">tskit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>tskit.tables</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for tskit.tables</h1><div class="highlight"><pre>
<span></span><span class="c1"># MIT License</span>
<span class="c1">#</span>
<span class="c1"># Copyright (c) 2018-2020 Tskit Developers</span>
<span class="c1"># Copyright (c) 2017 University of Oxford</span>
<span class="c1">#</span>
<span class="c1"># Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="c1"># of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<span class="c1"># in the Software without restriction, including without limitation the rights</span>
<span class="c1"># to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<span class="c1"># copies of the Software, and to permit persons to whom the Software is</span>
<span class="c1"># furnished to do so, subject to the following conditions:</span>
<span class="c1">#</span>
<span class="c1"># The above copyright notice and this permission notice shall be included in all</span>
<span class="c1"># copies or substantial portions of the Software.</span>
<span class="c1">#</span>
<span class="c1"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="c1"># IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="c1"># FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="c1"># AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="c1"># LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<span class="c1"># OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span class="c1"># SOFTWARE.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tree sequence IO via the tables API.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>

<span class="kn">import</span> <span class="nn">attr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">_tskit</span>
<span class="kn">import</span> <span class="nn">tskit</span>
<span class="kn">import</span> <span class="nn">tskit.metadata</span> <span class="k">as</span> <span class="nn">metadata</span>
<span class="kn">import</span> <span class="nn">tskit.provenance</span> <span class="k">as</span> <span class="nn">provenance</span>
<span class="kn">import</span> <span class="nn">tskit.util</span> <span class="k">as</span> <span class="nn">util</span>
<span class="kn">from</span> <span class="nn">tskit</span> <span class="kn">import</span> <span class="n">UNKNOWN_TIME</span>

<span class="n">attr_options</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;slots&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;frozen&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;auto_attribs&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>


<span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">eq</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">attr_options</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">IndividualTableRow</span><span class="p">:</span>
    <span class="n">flags</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">location</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="nb">bytes</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">flags</span><span class="p">,</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">array_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">location</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__neq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>


<span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="o">**</span><span class="n">attr_options</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">NodeTableRow</span><span class="p">:</span>
    <span class="n">flags</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">time</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">population</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">individual</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="nb">bytes</span>


<span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="o">**</span><span class="n">attr_options</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">EdgeTableRow</span><span class="p">:</span>
    <span class="n">left</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">right</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">parent</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">child</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="nb">bytes</span>


<span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="o">**</span><span class="n">attr_options</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MigrationTableRow</span><span class="p">:</span>
    <span class="n">left</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">right</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">node</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">source</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">dest</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">time</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="nb">bytes</span>


<span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="o">**</span><span class="n">attr_options</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">SiteTableRow</span><span class="p">:</span>
    <span class="n">position</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">ancestral_state</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="nb">bytes</span>


<span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="n">eq</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">attr_options</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MutationTableRow</span><span class="p">:</span>
    <span class="n">site</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">node</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">derived_state</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">parent</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="nb">bytes</span>
    <span class="n">time</span><span class="p">:</span> <span class="nb">float</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">MutationTableRow</span><span class="p">)</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">site</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">node</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_state</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">derived_state</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">parent</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">metadata</span>
            <span class="ow">and</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">time</span>
                <span class="ow">or</span> <span class="p">(</span>
                    <span class="n">util</span><span class="o">.</span><span class="n">is_unknown_time</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="ow">and</span> <span class="n">util</span><span class="o">.</span><span class="n">is_unknown_time</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="p">)</span>


<span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="o">**</span><span class="n">attr_options</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">PopulationTableRow</span><span class="p">:</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="nb">bytes</span>


<span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="o">**</span><span class="n">attr_options</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ProvenanceTableRow</span><span class="p">:</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">record</span><span class="p">:</span> <span class="nb">str</span>


<span class="nd">@attr</span><span class="o">.</span><span class="n">s</span><span class="p">(</span><span class="o">**</span><span class="n">attr_options</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TableCollectionIndexes</span><span class="p">:</span>
    <span class="n">edge_insertion_order</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">edge_removal_order</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">ib</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">attr</span><span class="o">.</span><span class="n">asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nbytes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_insertion_order</span><span class="o">.</span><span class="n">nbytes</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">edge_removal_order</span><span class="o">.</span><span class="n">nbytes</span>


<span class="k">def</span> <span class="nf">keep_with_offset</span><span class="p">(</span><span class="n">keep</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">offset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Used when filtering _offset columns in tables</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># We need the astype here for 32 bit machines</span>
    <span class="n">lens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">keep</span><span class="p">,</span> <span class="n">lens</span><span class="p">)],</span>
        <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">offset</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
                <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">lens</span><span class="p">[</span><span class="n">keep</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">offset</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">),</span>
    <span class="p">)</span>


<span class="k">class</span> <span class="nc">BaseTable</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Superclass of high-level tables. Not intended for direct instantiation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># The list of columns in the table. Must be set by subclasses.</span>
    <span class="n">column_names</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ll_table</span><span class="p">,</span> <span class="n">row_class</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span> <span class="o">=</span> <span class="n">ll_table</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">row_class</span> <span class="o">=</span> <span class="n">row_class</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_required_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> is required&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">num_rows</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">max_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">max_rows</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">max_rows_increment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">max_rows_increment</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nbytes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the total number of bytes required to store the data</span>
<span class="sd">        in this table. Note that this may not be equal to</span>
<span class="sd">        the actual memory footprint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># It&#39;s not ideal that we run asdict() here to do this as we&#39;re</span>
        <span class="c1"># currently creating copies of the column arrays, so it would</span>
        <span class="c1"># be more efficient to have dedicated low-level methods. However,</span>
        <span class="c1"># if we do have read-only views on the underlying memory for the</span>
        <span class="c1"># column arrays then this will be a perfectly good way of</span>
        <span class="c1"># computing the nbytes values and the overhead minimal.</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span>
        <span class="n">nbytes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Some tables don&#39;t have a metadata_schema</span>
        <span class="n">metadata_schema</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;metadata_schema&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">metadata_schema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nbytes</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">metadata_schema</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="n">nbytes</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">nbytes</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">nbytes</span>

    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">ignore_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if  `self` and `other` are equal. By default, two tables</span>
<span class="sd">        are considered equal if their columns and metadata schemas are</span>
<span class="sd">        byte-for-byte identical.</span>

<span class="sd">        :param other: Another table instance</span>
<span class="sd">        :param bool ignore_metadata: If True exclude metadata and metadata schemas</span>
<span class="sd">            from the comparison.</span>
<span class="sd">        :return: True if other is equal to this table; False otherwise.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Note: most tables support ignore_metadata, we can override for those that don&#39;t</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">ll_table</span><span class="p">,</span> <span class="n">ignore_metadata</span><span class="o">=</span><span class="n">ignore_metadata</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span>

    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_names</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> object has no attribute </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_names</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span>
            <span class="n">d</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the specifed row of this table, decoding metadata if it is present.</span>
<span class="sd">        Supports negative indexing, e.g. ``table[-5]``.</span>

<span class="sd">        :param int index: the zero-index of the desired row</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;Index out of bounds&quot;</span><span class="p">)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">get_row</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_row</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c1"># This means the class returns the low-level row unchanged.</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">row_class</span><span class="p">(</span><span class="o">*</span><span class="n">row</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes all rows in this table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Deprecated alias for clear</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">truncate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_rows</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Truncates this table so that the only the first ``num_rows`` are retained.</span>

<span class="sd">        :param int num_rows: The number of rows to retain in this table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">truncate</span><span class="p">(</span><span class="n">num_rows</span><span class="p">)</span>

    <span class="c1"># Pickle support</span>
    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span>

    <span class="c1"># Unpickle support</span>
    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a deep copy of this table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">()</span>
        <span class="n">copy</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">asdict</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">copy</span>

    <span class="k">def</span> <span class="nf">asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dictionary mapping the names of the columns in this table</span>
<span class="sd">        to the corresponding numpy arrays.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_names</span><span class="p">}</span>
        <span class="c1"># Not all tables have metadata</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ret</span><span class="p">[</span><span class="s2">&quot;metadata_schema&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_schema</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">set_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the values for each column in this :class:`Table` using</span>
<span class="sd">        values provided in numpy arrays. Overwrites any data currently stored in</span>
<span class="sd">        the table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">headers</span><span class="p">,</span> <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_text_header_and_rows</span><span class="p">()</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="p">[</span><span class="n">headers</span><span class="p">]</span> <span class="o">+</span> <span class="n">rows</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_repr_html_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called by jupyter notebooks to render tables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">headers</span><span class="p">,</span> <span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_text_header_and_rows</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;th&gt;</span><span class="si">{</span><span class="n">header</span><span class="si">}</span><span class="s2">&lt;/th&gt;&quot;</span> <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&lt;td&gt;&lt;em&gt;... skipped </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="mi">11</span><span class="p">:]</span><span class="si">}</span><span class="s2"> rows ...&lt;/em&gt;&lt;/td&gt;&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;__skipped__&quot;</span> <span class="ow">in</span> <span class="n">row</span>
            <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;td&gt;</span><span class="si">{</span><span class="n">cell</span><span class="si">}</span><span class="s2">&lt;/td&gt;&quot;</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">row</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span>
        <span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&lt;tr&gt;</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s2">&lt;/tr&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">)</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div&gt;</span>
<span class="s2">                &lt;style scoped=&quot;&quot;&gt;</span>
<span class="s2">                    .tskit-table tbody tr th:only-of-type </span><span class="se">{{</span><span class="s2">vertical-align: middle;</span><span class="se">}}</span><span class="s2"></span>
<span class="s2">                    .tskit-table tbody tr th </span><span class="se">{{</span><span class="s2">vertical-align: top;</span><span class="se">}}</span><span class="s2"></span>
<span class="s2">                    .tskit-table tbody td </span><span class="se">{{</span><span class="s2">text-align: right;</span><span class="se">}}</span><span class="s2"></span>
<span class="s2">                &lt;/style&gt;</span>
<span class="s2">                &lt;table border=&quot;1&quot; class=&quot;tskit-table&quot;&gt;</span>
<span class="s2">                    &lt;thead&gt;</span>
<span class="s2">                        &lt;tr&gt;</span>
<span class="s2">                            </span><span class="si">{</span><span class="n">headers</span><span class="si">}</span><span class="s2"></span>
<span class="s2">                        &lt;/tr&gt;</span>
<span class="s2">                    &lt;/thead&gt;</span>
<span class="s2">                    &lt;tbody&gt;</span>
<span class="s2">                        </span><span class="si">{</span><span class="n">rows</span><span class="si">}</span><span class="s2"></span>
<span class="s2">                    &lt;/tbody&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">MetadataMixin</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mixin class for tables that have a metadata column.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata_column_index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">attr</span><span class="o">.</span><span class="n">fields_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">row_class</span><span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;metadata&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_metadata_schema_cache_from_ll</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">packset_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadatas</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Packs the specified list of metadata values and updates the ``metadata``</span>
<span class="sd">        and ``metadata_offset`` columns. The length of the metadatas array</span>
<span class="sd">        must be equal to the number of rows in the table.</span>

<span class="sd">        :param list metadatas: A list of metadata bytes values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">packed</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">pack_bytes</span><span class="p">(</span><span class="n">metadatas</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">packed</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;metadata_offset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">metadata_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">metadata</span><span class="o">.</span><span class="n">MetadataSchema</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The :class:`tskit.MetadataSchema` for this table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_schema_cache</span>

    <span class="nd">@metadata_schema</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">metadata_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">MetadataSchema</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">metadata_schema</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_metadata_schema_cache_from_ll</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">decode_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">row</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_column_index</span><span class="p">]</span>
            <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata_schema_cache</span><span class="o">.</span><span class="n">decode_row</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_column_index</span><span class="p">]),)</span>
            <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_column_index</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">:]</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_metadata_schema_cache_from_ll</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_schema_cache</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">parse_metadata_schema</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">metadata_schema</span>
        <span class="p">)</span>


<div class="viewcode-block" id="IndividualTable"><a class="viewcode-back" href="../../python-api.html#tskit.IndividualTable">[docs]</a><span class="k">class</span> <span class="nc">IndividualTable</span><span class="p">(</span><span class="n">BaseTable</span><span class="p">,</span> <span class="n">MetadataMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A table defining the individuals in a tree sequence. Note that although</span>
<span class="sd">    each Individual has associated nodes, reference to these is not stored in</span>
<span class="sd">    the individual table, but rather reference to the individual is stored for</span>
<span class="sd">    each node in the :class:`NodeTable`.  This is similar to the way in which</span>
<span class="sd">    the relationship between sites and mutations is modelled.</span>

<span class="sd">    :warning: The numpy arrays returned by table attribute accesses are **copies**</span>
<span class="sd">        of the underlying data. In particular, this means that you cannot edit</span>
<span class="sd">        the values in the columns by updating the attribute arrays.</span>

<span class="sd">        **NOTE:** this behaviour may change in future.</span>

<span class="sd">    :ivar flags: The array of flags values.</span>
<span class="sd">    :vartype flags: numpy.ndarray, dtype=np.uint32</span>
<span class="sd">    :ivar location: The flattened array of floating point location values. See</span>
<span class="sd">        :ref:`sec_encoding_ragged_columns` for more details.</span>
<span class="sd">    :vartype location: numpy.ndarray, dtype=np.float64</span>
<span class="sd">    :ivar location_offset: The array of offsets into the location column. See</span>
<span class="sd">        :ref:`sec_encoding_ragged_columns` for more details.</span>
<span class="sd">    :vartype location_offset: numpy.ndarray, dtype=np.uint32</span>
<span class="sd">    :ivar metadata: The flattened array of binary metadata values. See</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more details.</span>
<span class="sd">    :vartype metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">    :ivar metadata_offset: The array of offsets into the metadata column. See</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more details.</span>
<span class="sd">    :vartype metadata_offset: numpy.ndarray, dtype=np.uint32</span>
<span class="sd">    :ivar metadata_schema: The metadata schema for this table&#39;s metadata column</span>
<span class="sd">    :vartype metadata_schema: tskit.MetadataSchema</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;flags&quot;</span><span class="p">,</span>
        <span class="s2">&quot;location&quot;</span><span class="p">,</span>
        <span class="s2">&quot;location_offset&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata_offset&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_rows_increment</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ll_table</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ll_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ll_table</span> <span class="o">=</span> <span class="n">_tskit</span><span class="o">.</span><span class="n">IndividualTable</span><span class="p">(</span><span class="n">max_rows_increment</span><span class="o">=</span><span class="n">max_rows_increment</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ll_table</span><span class="p">,</span> <span class="n">IndividualTableRow</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_text_header_and_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span>
        <span class="n">location</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">unpack_arrays</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">location_offset</span><span class="p">)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">unpack_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_offset</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;flags&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">&lt;=</span> <span class="n">limit</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                <span class="nb">range</span><span class="p">(</span><span class="n">limit</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">-</span> <span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="p">(</span><span class="n">limit</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;__skipped__</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="o">-</span><span class="n">limit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">md</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
                <span class="n">location_str</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">location</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">flags</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">location_str</span><span class="p">,</span> <span class="n">md</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">headers</span><span class="p">,</span> <span class="n">rows</span>

<div class="viewcode-block" id="IndividualTable.add_row"><a class="viewcode-back" href="../../python-api.html#tskit.IndividualTable.add_row">[docs]</a>    <span class="k">def</span> <span class="nf">add_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new row to this :class:`IndividualTable` and returns the ID of the</span>
<span class="sd">        corresponding individual. Metadata, if specified, will be validated and encoded</span>
<span class="sd">        according to the table&#39;s</span>
<span class="sd">        :attr:`metadata_schema&lt;tskit.IndividualTable.metadata_schema&gt;`.</span>

<span class="sd">        :param int flags: The bitwise flags for the new node.</span>
<span class="sd">        :param array-like location: A list of numeric values or one-dimensional numpy</span>
<span class="sd">            array describing the location of this individual. If not specified</span>
<span class="sd">            or None, a zero-dimensional location is stored.</span>
<span class="sd">        :param object metadata: Any object that is valid metadata for the table&#39;s schema.</span>
<span class="sd">        :return: The ID of the newly added node.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_schema</span><span class="o">.</span><span class="n">validate_and_encode_row</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span></div>

<div class="viewcode-block" id="IndividualTable.set_columns"><a class="viewcode-back" href="../../python-api.html#tskit.IndividualTable.set_columns">[docs]</a>    <span class="k">def</span> <span class="nf">set_columns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">flags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">location_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the values for each column in this :class:`IndividualTable` using the</span>
<span class="sd">        values in the specified arrays. Overwrites any data currently stored in</span>
<span class="sd">        the table.</span>

<span class="sd">        The ``flags`` array is mandatory and defines the number of individuals</span>
<span class="sd">        the table will contain.</span>
<span class="sd">        The ``location`` and ``location_offset`` parameters must be supplied</span>
<span class="sd">        together, and meet the requirements for :ref:`sec_encoding_ragged_columns`.</span>
<span class="sd">        The ``metadata`` and ``metadata_offset`` parameters must be supplied</span>
<span class="sd">        together, and meet the requirements for :ref:`sec_encoding_ragged_columns`.</span>
<span class="sd">        See :ref:`sec_tables_api_binary_columns` for more information and</span>
<span class="sd">        :ref:`sec_tutorial_metadata_bulk` for an example of how to prepare metadata.</span>

<span class="sd">        :param flags: The bitwise flags for each individual. Required.</span>
<span class="sd">        :type flags: numpy.ndarray, dtype=np.uint32</span>
<span class="sd">        :param location: The flattened location array. Must be specified along</span>
<span class="sd">            with ``location_offset``. If not specified or None, an empty location</span>
<span class="sd">            value is stored for each individual.</span>
<span class="sd">        :type location: numpy.ndarray, dtype=np.float64</span>
<span class="sd">        :param location_offset: The offsets into the ``location`` array.</span>
<span class="sd">        :type location_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        :param metadata: The flattened metadata array. Must be specified along</span>
<span class="sd">            with ``metadata_offset``. If not specified or None, an empty metadata</span>
<span class="sd">            value is stored for each individual.</span>
<span class="sd">        :type metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param metadata_offset: The offsets into the ``metadata`` array.</span>
<span class="sd">        :type metadata_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        :param metadata_schema: The encoded metadata schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_required_args</span><span class="p">(</span><span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span>
                <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
                <span class="n">location_offset</span><span class="o">=</span><span class="n">location_offset</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                <span class="n">metadata_offset</span><span class="o">=</span><span class="n">metadata_offset</span><span class="p">,</span>
                <span class="n">metadata_schema</span><span class="o">=</span><span class="n">metadata_schema</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="IndividualTable.append_columns"><a class="viewcode-back" href="../../python-api.html#tskit.IndividualTable.append_columns">[docs]</a>    <span class="k">def</span> <span class="nf">append_columns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">flags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">location_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Appends the specified arrays to the end of the columns in this</span>
<span class="sd">        :class:`IndividualTable`. This allows many new rows to be added at once.</span>

<span class="sd">        The ``flags`` array is mandatory and defines the number of</span>
<span class="sd">        extra individuals to add to the table.</span>
<span class="sd">        The ``location`` and ``location_offset`` parameters must be supplied</span>
<span class="sd">        together, and meet the requirements for :ref:`sec_encoding_ragged_columns`.</span>
<span class="sd">        The ``metadata`` and ``metadata_offset`` parameters must be supplied</span>
<span class="sd">        together, and meet the requirements for :ref:`sec_encoding_ragged_columns`.</span>
<span class="sd">        See :ref:`sec_tables_api_binary_columns` for more information and</span>
<span class="sd">        :ref:`sec_tutorial_metadata_bulk` for an example of how to prepare metadata.</span>

<span class="sd">        :param flags: The bitwise flags for each individual. Required.</span>
<span class="sd">        :type flags: numpy.ndarray, dtype=np.uint32</span>
<span class="sd">        :param location: The flattened location array. Must be specified along</span>
<span class="sd">            with ``location_offset``. If not specified or None, an empty location</span>
<span class="sd">            value is stored for each individual.</span>
<span class="sd">        :type location: numpy.ndarray, dtype=np.float64</span>
<span class="sd">        :param location_offset: The offsets into the ``location`` array.</span>
<span class="sd">        :type location_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        :param metadata: The flattened metadata array. Must be specified along</span>
<span class="sd">            with ``metadata_offset``. If not specified or None, an empty metadata</span>
<span class="sd">            value is stored for each individual.</span>
<span class="sd">        :type metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param metadata_offset: The offsets into the ``metadata`` array.</span>
<span class="sd">        :type metadata_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_required_args</span><span class="p">(</span><span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">append_columns</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span>
                <span class="n">location</span><span class="o">=</span><span class="n">location</span><span class="p">,</span>
                <span class="n">location_offset</span><span class="o">=</span><span class="n">location_offset</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                <span class="n">metadata_offset</span><span class="o">=</span><span class="n">metadata_offset</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="IndividualTable.packset_location"><a class="viewcode-back" href="../../python-api.html#tskit.IndividualTable.packset_location">[docs]</a>    <span class="k">def</span> <span class="nf">packset_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locations</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Packs the specified list of location values and updates the ``location``</span>
<span class="sd">        and ``location_offset`` columns. The length of the locations array</span>
<span class="sd">        must be equal to the number of rows in the table.</span>

<span class="sd">        :param list locations: A list of locations interpreted as numpy float64</span>
<span class="sd">            arrays.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">packed</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">pack_arrays</span><span class="p">(</span><span class="n">locations</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;location&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">packed</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;location_offset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="NodeTable"><a class="viewcode-back" href="../../python-api.html#tskit.NodeTable">[docs]</a><span class="k">class</span> <span class="nc">NodeTable</span><span class="p">(</span><span class="n">BaseTable</span><span class="p">,</span> <span class="n">MetadataMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A table defining the nodes in a tree sequence. See the</span>
<span class="sd">    :ref:`definitions &lt;sec_node_table_definition&gt;` for details on the columns</span>
<span class="sd">    in this table and the</span>
<span class="sd">    :ref:`tree sequence requirements &lt;sec_valid_tree_sequence_requirements&gt;` section</span>
<span class="sd">    for the properties needed for a node table to be a part of a valid tree sequence.</span>

<span class="sd">    :warning: The numpy arrays returned by table attribute accesses are **copies**</span>
<span class="sd">        of the underlying data. In particular, this means that you cannot edit</span>
<span class="sd">        the values in the columns by updating the attribute arrays.</span>

<span class="sd">        **NOTE:** this behaviour may change in future.</span>

<span class="sd">    :ivar time: The array of time values.</span>
<span class="sd">    :vartype time: numpy.ndarray, dtype=np.float64</span>
<span class="sd">    :ivar flags: The array of flags values.</span>
<span class="sd">    :vartype flags: numpy.ndarray, dtype=np.uint32</span>
<span class="sd">    :ivar population: The array of population IDs.</span>
<span class="sd">    :vartype population: numpy.ndarray, dtype=np.int32</span>
<span class="sd">    :ivar individual: The array of individual IDs that each node belongs to.</span>
<span class="sd">    :vartype individual: numpy.ndarray, dtype=np.int32</span>
<span class="sd">    :ivar metadata: The flattened array of binary metadata values. See</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more details.</span>
<span class="sd">    :vartype metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">    :ivar metadata_offset: The array of offsets into the metadata column. See</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more details.</span>
<span class="sd">    :vartype metadata_offset: numpy.ndarray, dtype=np.uint32</span>
<span class="sd">    :ivar metadata_schema: The metadata schema for this table&#39;s metadata column</span>
<span class="sd">    :vartype metadata_schema: tskit.MetadataSchema</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;flags&quot;</span><span class="p">,</span>
        <span class="s2">&quot;population&quot;</span><span class="p">,</span>
        <span class="s2">&quot;individual&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata_offset&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_rows_increment</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ll_table</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ll_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ll_table</span> <span class="o">=</span> <span class="n">_tskit</span><span class="o">.</span><span class="n">NodeTable</span><span class="p">(</span><span class="n">max_rows_increment</span><span class="o">=</span><span class="n">max_rows_increment</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ll_table</span><span class="p">,</span> <span class="n">NodeTableRow</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_text_header_and_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span>
        <span class="n">population</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">population</span>
        <span class="n">individual</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">individual</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">unpack_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_offset</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;flags&quot;</span><span class="p">,</span> <span class="s2">&quot;population&quot;</span><span class="p">,</span> <span class="s2">&quot;individual&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">&lt;=</span> <span class="n">limit</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                <span class="nb">range</span><span class="p">(</span><span class="n">limit</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">-</span> <span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="p">(</span><span class="n">limit</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;__skipped__</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="o">-</span><span class="n">limit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">md</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{:.14f}</span><span class="se">\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">j</span><span class="p">,</span> <span class="n">flags</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">population</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">individual</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">time</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">md</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">headers</span><span class="p">,</span> <span class="n">rows</span>

<div class="viewcode-block" id="NodeTable.add_row"><a class="viewcode-back" href="../../python-api.html#tskit.NodeTable.add_row">[docs]</a>    <span class="k">def</span> <span class="nf">add_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">population</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">individual</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new row to this :class:`NodeTable` and returns the ID of the</span>
<span class="sd">        corresponding node. Metadata, if specified, will be validated and encoded</span>
<span class="sd">        according to the table&#39;s</span>
<span class="sd">        :attr:`metadata_schema&lt;tskit.NodeTable.metadata_schema&gt;`.</span>

<span class="sd">        :param int flags: The bitwise flags for the new node.</span>
<span class="sd">        :param float time: The birth time for the new node.</span>
<span class="sd">        :param int population: The ID of the population in which the new node was born.</span>
<span class="sd">            Defaults to :data:`tskit.NULL`.</span>
<span class="sd">        :param int individual: The ID of the individual in which the new node was born.</span>
<span class="sd">            Defaults to :data:`tskit.NULL`.</span>
<span class="sd">        :param object metadata: Any object that is valid metadata for the table&#39;s schema.</span>
<span class="sd">        :return: The ID of the newly added node.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_schema</span><span class="o">.</span><span class="n">validate_and_encode_row</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">flags</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">population</span><span class="p">,</span> <span class="n">individual</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span></div>

<div class="viewcode-block" id="NodeTable.set_columns"><a class="viewcode-back" href="../../python-api.html#tskit.NodeTable.set_columns">[docs]</a>    <span class="k">def</span> <span class="nf">set_columns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">flags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">population</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">individual</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the values for each column in this :class:`NodeTable` using the values in</span>
<span class="sd">        the specified arrays. Overwrites any data currently stored in the table.</span>

<span class="sd">        The ``flags``, ``time`` and ``population`` arrays must all be of the same length,</span>
<span class="sd">        which is equal to the number of nodes the table will contain. The</span>
<span class="sd">        ``metadata`` and ``metadata_offset`` parameters must be supplied together, and</span>
<span class="sd">        meet the requirements for :ref:`sec_encoding_ragged_columns`.</span>
<span class="sd">        See :ref:`sec_tables_api_binary_columns` for more information and</span>
<span class="sd">        :ref:`sec_tutorial_metadata_bulk` for an example of how to prepare metadata.</span>

<span class="sd">        :param flags: The bitwise flags for each node. Required.</span>
<span class="sd">        :type flags: numpy.ndarray, dtype=np.uint32</span>
<span class="sd">        :param time: The time values for each node. Required.</span>
<span class="sd">        :type time: numpy.ndarray, dtype=np.float64</span>
<span class="sd">        :param population: The population values for each node. If not specified</span>
<span class="sd">            or None, the :data:`tskit.NULL` value is stored for each node.</span>
<span class="sd">        :type population: numpy.ndarray, dtype=np.int32</span>
<span class="sd">        :param individual: The individual values for each node. If not specified</span>
<span class="sd">            or None, the :data:`tskit.NULL` value is stored for each node.</span>
<span class="sd">        :type individual: numpy.ndarray, dtype=np.int32</span>
<span class="sd">        :param metadata: The flattened metadata array. Must be specified along</span>
<span class="sd">            with ``metadata_offset``. If not specified or None, an empty metadata</span>
<span class="sd">            value is stored for each node.</span>
<span class="sd">        :type metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param metadata_offset: The offsets into the ``metadata`` array.</span>
<span class="sd">        :type metadata_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        :param metadata_schema: The encoded metadata schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_required_args</span><span class="p">(</span><span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span>
                <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
                <span class="n">population</span><span class="o">=</span><span class="n">population</span><span class="p">,</span>
                <span class="n">individual</span><span class="o">=</span><span class="n">individual</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                <span class="n">metadata_offset</span><span class="o">=</span><span class="n">metadata_offset</span><span class="p">,</span>
                <span class="n">metadata_schema</span><span class="o">=</span><span class="n">metadata_schema</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="NodeTable.append_columns"><a class="viewcode-back" href="../../python-api.html#tskit.NodeTable.append_columns">[docs]</a>    <span class="k">def</span> <span class="nf">append_columns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">flags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">population</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">individual</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Appends the specified arrays to the end of the columns in this</span>
<span class="sd">        :class:`NodeTable`. This allows many new rows to be added at once.</span>

<span class="sd">        The ``flags``, ``time`` and ``population`` arrays must all be of the same length,</span>
<span class="sd">        which is equal to the number of nodes that will be added to the table. The</span>
<span class="sd">        ``metadata`` and ``metadata_offset`` parameters must be supplied together, and</span>
<span class="sd">        meet the requirements for :ref:`sec_encoding_ragged_columns`.</span>
<span class="sd">        See :ref:`sec_tables_api_binary_columns` for more information and</span>
<span class="sd">        :ref:`sec_tutorial_metadata_bulk` for an example of how to prepare metadata.</span>

<span class="sd">        :param flags: The bitwise flags for each node. Required.</span>
<span class="sd">        :type flags: numpy.ndarray, dtype=np.uint32</span>
<span class="sd">        :param time: The time values for each node. Required.</span>
<span class="sd">        :type time: numpy.ndarray, dtype=np.float64</span>
<span class="sd">        :param population: The population values for each node. If not specified</span>
<span class="sd">            or None, the :data:`tskit.NULL` value is stored for each node.</span>
<span class="sd">        :type population: numpy.ndarray, dtype=np.int32</span>
<span class="sd">        :param individual: The individual values for each node. If not specified</span>
<span class="sd">            or None, the :data:`tskit.NULL` value is stored for each node.</span>
<span class="sd">        :type individual: numpy.ndarray, dtype=np.int32</span>
<span class="sd">        :param metadata: The flattened metadata array. Must be specified along</span>
<span class="sd">            with ``metadata_offset``. If not specified or None, an empty metadata</span>
<span class="sd">            value is stored for each node.</span>
<span class="sd">        :type metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param metadata_offset: The offsets into the ``metadata`` array.</span>
<span class="sd">        :type metadata_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_required_args</span><span class="p">(</span><span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">append_columns</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">,</span>
                <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
                <span class="n">population</span><span class="o">=</span><span class="n">population</span><span class="p">,</span>
                <span class="n">individual</span><span class="o">=</span><span class="n">individual</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                <span class="n">metadata_offset</span><span class="o">=</span><span class="n">metadata_offset</span><span class="p">,</span>
                <span class="n">metadata_schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="EdgeTable"><a class="viewcode-back" href="../../python-api.html#tskit.EdgeTable">[docs]</a><span class="k">class</span> <span class="nc">EdgeTable</span><span class="p">(</span><span class="n">BaseTable</span><span class="p">,</span> <span class="n">MetadataMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A table defining the edges in a tree sequence. See the</span>
<span class="sd">    :ref:`definitions &lt;sec_edge_table_definition&gt;` for details on the columns</span>
<span class="sd">    in this table and the</span>
<span class="sd">    :ref:`tree sequence requirements &lt;sec_valid_tree_sequence_requirements&gt;` section</span>
<span class="sd">    for the properties needed for an edge table to be a part of a valid tree sequence.</span>

<span class="sd">    :warning: The numpy arrays returned by table attribute accesses are **copies**</span>
<span class="sd">        of the underlying data. In particular, this means that you cannot edit</span>
<span class="sd">        the values in the columns by updating the attribute arrays.</span>

<span class="sd">        **NOTE:** this behaviour may change in future.</span>

<span class="sd">    :ivar left: The array of left coordinates.</span>
<span class="sd">    :vartype left: numpy.ndarray, dtype=np.float64</span>
<span class="sd">    :ivar right: The array of right coordinates.</span>
<span class="sd">    :vartype right: numpy.ndarray, dtype=np.float64</span>
<span class="sd">    :ivar parent: The array of parent node IDs.</span>
<span class="sd">    :vartype parent: numpy.ndarray, dtype=np.int32</span>
<span class="sd">    :ivar child: The array of child node IDs.</span>
<span class="sd">    :vartype child: numpy.ndarray, dtype=np.int32</span>
<span class="sd">    :ivar metadata: The flattened array of binary metadata values. See</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more details.</span>
<span class="sd">    :vartype metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">    :ivar metadata_offset: The array of offsets into the metadata column. See</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more details.</span>
<span class="sd">    :vartype metadata_offset: numpy.ndarray, dtype=np.uint32</span>
<span class="sd">    :ivar metadata_schema: The metadata schema for this table&#39;s metadata column</span>
<span class="sd">    :vartype metadata_schema: tskit.MetadataSchema</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;left&quot;</span><span class="p">,</span>
        <span class="s2">&quot;right&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;child&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata_offset&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_rows_increment</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ll_table</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ll_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ll_table</span> <span class="o">=</span> <span class="n">_tskit</span><span class="o">.</span><span class="n">EdgeTable</span><span class="p">(</span><span class="n">max_rows_increment</span><span class="o">=</span><span class="n">max_rows_increment</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ll_table</span><span class="p">,</span> <span class="n">EdgeTableRow</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_text_header_and_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span>
        <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">child</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">unpack_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_offset</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;left</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;right</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">,</span> <span class="s2">&quot;child&quot;</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">&lt;=</span> <span class="n">limit</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                <span class="nb">range</span><span class="p">(</span><span class="n">limit</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">-</span> <span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="p">(</span><span class="n">limit</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;__skipped__</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="o">-</span><span class="n">limit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">md</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="se">\t</span><span class="si">{:.8f}</span><span class="se">\t</span><span class="si">{:.8f}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">j</span><span class="p">,</span> <span class="n">left</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">right</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">parent</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">child</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">md</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">headers</span><span class="p">,</span> <span class="n">rows</span>

<div class="viewcode-block" id="EdgeTable.add_row"><a class="viewcode-back" href="../../python-api.html#tskit.EdgeTable.add_row">[docs]</a>    <span class="k">def</span> <span class="nf">add_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new row to this :class:`EdgeTable` and returns the ID of the</span>
<span class="sd">        corresponding edge. Metadata, if specified, will be validated and encoded</span>
<span class="sd">        according to the table&#39;s</span>
<span class="sd">        :attr:`metadata_schema&lt;tskit.EdgeTable.metadata_schema&gt;`.</span>

<span class="sd">        :param float left: The left coordinate (inclusive).</span>
<span class="sd">        :param float right: The right coordinate (exclusive).</span>
<span class="sd">        :param int parent: The ID of parent node.</span>
<span class="sd">        :param int child: The ID of child node.</span>
<span class="sd">        :param object metadata: Any object that is valid metadata for the table&#39;s schema.</span>
<span class="sd">        :return: The ID of the newly added edge.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_schema</span><span class="o">.</span><span class="n">validate_and_encode_row</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span></div>

<div class="viewcode-block" id="EdgeTable.set_columns"><a class="viewcode-back" href="../../python-api.html#tskit.EdgeTable.set_columns">[docs]</a>    <span class="k">def</span> <span class="nf">set_columns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">child</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the values for each column in this :class:`EdgeTable` using the values</span>
<span class="sd">        in the specified arrays. Overwrites any data currently stored in the table.</span>

<span class="sd">        The ``left``, ``right``, ``parent`` and ``child`` parameters are mandatory,</span>
<span class="sd">        and must be numpy arrays of the same length (which is equal to the number of</span>
<span class="sd">        edges the table will contain).</span>
<span class="sd">        The ``metadata`` and ``metadata_offset`` parameters must be supplied together,</span>
<span class="sd">        and meet the requirements for :ref:`sec_encoding_ragged_columns`.</span>
<span class="sd">        See :ref:`sec_tables_api_binary_columns` for more information and</span>
<span class="sd">        :ref:`sec_tutorial_metadata_bulk` for an example of how to prepare metadata.</span>


<span class="sd">        :param left: The left coordinates (inclusive).</span>
<span class="sd">        :type left: numpy.ndarray, dtype=np.float64</span>
<span class="sd">        :param right: The right coordinates (exclusive).</span>
<span class="sd">        :type right: numpy.ndarray, dtype=np.float64</span>
<span class="sd">        :param parent: The parent node IDs.</span>
<span class="sd">        :type parent: numpy.ndarray, dtype=np.int32</span>
<span class="sd">        :param child: The child node IDs.</span>
<span class="sd">        :type child: numpy.ndarray, dtype=np.int32</span>
<span class="sd">        :param metadata: The flattened metadata array. Must be specified along</span>
<span class="sd">            with ``metadata_offset``. If not specified or None, an empty metadata</span>
<span class="sd">            value is stored for each node.</span>
<span class="sd">        :type metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param metadata_offset: The offsets into the ``metadata`` array.</span>
<span class="sd">        :type metadata_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        :param metadata_schema: The encoded metadata schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_required_args</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="n">child</span><span class="o">=</span><span class="n">child</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span>
                <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span>
                <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
                <span class="n">child</span><span class="o">=</span><span class="n">child</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                <span class="n">metadata_offset</span><span class="o">=</span><span class="n">metadata_offset</span><span class="p">,</span>
                <span class="n">metadata_schema</span><span class="o">=</span><span class="n">metadata_schema</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="EdgeTable.append_columns"><a class="viewcode-back" href="../../python-api.html#tskit.EdgeTable.append_columns">[docs]</a>    <span class="k">def</span> <span class="nf">append_columns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata_offset</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Appends the specified arrays to the end of the columns of this</span>
<span class="sd">        :class:`EdgeTable`. This allows many new rows to be added at once.</span>

<span class="sd">        The ``left``, ``right``, ``parent`` and ``child`` parameters are mandatory,</span>
<span class="sd">        and must be numpy arrays of the same length (which is equal to the number of</span>
<span class="sd">        additional edges to add to the table). The ``metadata`` and</span>
<span class="sd">        ``metadata_offset`` parameters must be supplied together, and</span>
<span class="sd">        meet the requirements for :ref:`sec_encoding_ragged_columns`.</span>
<span class="sd">        See :ref:`sec_tables_api_binary_columns` for more information and</span>
<span class="sd">        :ref:`sec_tutorial_metadata_bulk` for an example of how to prepare metadata.</span>


<span class="sd">        :param left: The left coordinates (inclusive).</span>
<span class="sd">        :type left: numpy.ndarray, dtype=np.float64</span>
<span class="sd">        :param right: The right coordinates (exclusive).</span>
<span class="sd">        :type right: numpy.ndarray, dtype=np.float64</span>
<span class="sd">        :param parent: The parent node IDs.</span>
<span class="sd">        :type parent: numpy.ndarray, dtype=np.int32</span>
<span class="sd">        :param child: The child node IDs.</span>
<span class="sd">        :type child: numpy.ndarray, dtype=np.int32</span>
<span class="sd">        :param metadata: The flattened metadata array. Must be specified along</span>
<span class="sd">            with ``metadata_offset``. If not specified or None, an empty metadata</span>
<span class="sd">            value is stored for each node.</span>
<span class="sd">        :type metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param metadata_offset: The offsets into the ``metadata`` array.</span>
<span class="sd">        :type metadata_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">append_columns</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span>
                <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span>
                <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
                <span class="n">child</span><span class="o">=</span><span class="n">child</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                <span class="n">metadata_offset</span><span class="o">=</span><span class="n">metadata_offset</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="EdgeTable.squash"><a class="viewcode-back" href="../../python-api.html#tskit.EdgeTable.squash">[docs]</a>    <span class="k">def</span> <span class="nf">squash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sorts, then condenses the table into the smallest possible number of rows by</span>
<span class="sd">        combining any adjacent edges.</span>
<span class="sd">        A pair of edges is said to be `adjacent` if they have the same parent and child</span>
<span class="sd">        nodes, and if the left coordinate of one of the edges is equal to the right</span>
<span class="sd">        coordinate of the other edge.</span>
<span class="sd">        The ``squash`` method modifies an :class:`EdgeTable` in place so that any set of</span>
<span class="sd">        adjacent edges is replaced by a single edge.</span>
<span class="sd">        The new edge will have the same parent and child node, a left coordinate</span>
<span class="sd">        equal to the smallest left coordinate in the set, and a right coordinate</span>
<span class="sd">        equal to the largest right coordinate in the set.</span>
<span class="sd">        The new edge table will be sorted in the canonical order (P, C, L, R).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">squash</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="MigrationTable"><a class="viewcode-back" href="../../python-api.html#tskit.MigrationTable">[docs]</a><span class="k">class</span> <span class="nc">MigrationTable</span><span class="p">(</span><span class="n">BaseTable</span><span class="p">,</span> <span class="n">MetadataMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A table defining the migrations in a tree sequence. See the</span>
<span class="sd">    :ref:`definitions &lt;sec_migration_table_definition&gt;` for details on the columns</span>
<span class="sd">    in this table and the</span>
<span class="sd">    :ref:`tree sequence requirements &lt;sec_valid_tree_sequence_requirements&gt;` section</span>
<span class="sd">    for the properties needed for a migration table to be a part of a valid tree</span>
<span class="sd">    sequence.</span>

<span class="sd">    :warning: The numpy arrays returned by table attribute accesses are **copies**</span>
<span class="sd">        of the underlying data. In particular, this means that you cannot edit</span>
<span class="sd">        the values in the columns by updating the attribute arrays.</span>

<span class="sd">        **NOTE:** this behaviour may change in future.</span>

<span class="sd">    :ivar left: The array of left coordinates.</span>
<span class="sd">    :vartype left: numpy.ndarray, dtype=np.float64</span>
<span class="sd">    :ivar right: The array of right coordinates.</span>
<span class="sd">    :vartype right: numpy.ndarray, dtype=np.float64</span>
<span class="sd">    :ivar node: The array of node IDs.</span>
<span class="sd">    :vartype node: numpy.ndarray, dtype=np.int32</span>
<span class="sd">    :ivar source: The array of source population IDs.</span>
<span class="sd">    :vartype source: numpy.ndarray, dtype=np.int32</span>
<span class="sd">    :ivar dest: The array of destination population IDs.</span>
<span class="sd">    :vartype dest: numpy.ndarray, dtype=np.int32</span>
<span class="sd">    :ivar time: The array of time values.</span>
<span class="sd">    :vartype time: numpy.ndarray, dtype=np.float64</span>
<span class="sd">    :ivar metadata: The flattened array of binary metadata values. See</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more details.</span>
<span class="sd">    :vartype metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">    :ivar metadata_offset: The array of offsets into the metadata column. See</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more details.</span>
<span class="sd">    :vartype metadata_offset: numpy.ndarray, dtype=np.uint32</span>
<span class="sd">    :ivar metadata_schema: The metadata schema for this table&#39;s metadata column</span>
<span class="sd">    :vartype metadata_schema: tskit.MetadataSchema</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;left&quot;</span><span class="p">,</span>
        <span class="s2">&quot;right&quot;</span><span class="p">,</span>
        <span class="s2">&quot;node&quot;</span><span class="p">,</span>
        <span class="s2">&quot;source&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dest&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata_offset&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_rows_increment</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ll_table</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ll_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ll_table</span> <span class="o">=</span> <span class="n">_tskit</span><span class="o">.</span><span class="n">MigrationTable</span><span class="p">(</span><span class="n">max_rows_increment</span><span class="o">=</span><span class="n">max_rows_increment</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ll_table</span><span class="p">,</span> <span class="n">MigrationTableRow</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_text_header_and_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">left</span>
        <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">right</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span>
        <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">unpack_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_offset</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;node&quot;</span><span class="p">,</span> <span class="s2">&quot;source&quot;</span><span class="p">,</span> <span class="s2">&quot;dest&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">&lt;=</span> <span class="n">limit</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                <span class="nb">range</span><span class="p">(</span><span class="n">limit</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">-</span> <span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="p">(</span><span class="n">limit</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;__skipped__</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="o">-</span><span class="n">limit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">md</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="se">\t</span><span class="si">{:.8f}</span><span class="se">\t</span><span class="si">{:.8f}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{:.8f}</span><span class="se">\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">j</span><span class="p">,</span> <span class="n">left</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">right</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">node</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">source</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">dest</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">time</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">md</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">headers</span><span class="p">,</span> <span class="n">rows</span>

<div class="viewcode-block" id="MigrationTable.add_row"><a class="viewcode-back" href="../../python-api.html#tskit.MigrationTable.add_row">[docs]</a>    <span class="k">def</span> <span class="nf">add_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new row to this :class:`MigrationTable` and returns the ID of the</span>
<span class="sd">        corresponding migration. Metadata, if specified, will be validated and encoded</span>
<span class="sd">        according to the table&#39;s</span>
<span class="sd">        :attr:`metadata_schema&lt;tskit.MigrationTable.metadata_schema&gt;`.</span>

<span class="sd">        :param float left: The left coordinate (inclusive).</span>
<span class="sd">        :param float right: The right coordinate (exclusive).</span>
<span class="sd">        :param int node: The node ID.</span>
<span class="sd">        :param int source: The ID of the source population.</span>
<span class="sd">        :param int dest: The ID of the destination population.</span>
<span class="sd">        :param float time: The time of the migration event.</span>
<span class="sd">        :param object metadata: Any object that is valid metadata for the table&#39;s schema.</span>
<span class="sd">        :return: The ID of the newly added migration.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_schema</span><span class="o">.</span><span class="n">validate_and_encode_row</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span></div>

<div class="viewcode-block" id="MigrationTable.set_columns"><a class="viewcode-back" href="../../python-api.html#tskit.MigrationTable.set_columns">[docs]</a>    <span class="k">def</span> <span class="nf">set_columns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the values for each column in this :class:`MigrationTable` using the values</span>
<span class="sd">        in the specified arrays. Overwrites any data currently stored in the table.</span>

<span class="sd">        All parameters except ``metadata`` and ``metadata_offset`` and are mandatory,</span>
<span class="sd">        and must be numpy arrays of the same length (which is equal to the number of</span>
<span class="sd">        migrations the table will contain).</span>
<span class="sd">        The ``metadata`` and ``metadata_offset`` parameters must be supplied together,</span>
<span class="sd">        and meet the requirements for :ref:`sec_encoding_ragged_columns`.</span>
<span class="sd">        See :ref:`sec_tables_api_binary_columns` for more information and</span>
<span class="sd">        :ref:`sec_tutorial_metadata_bulk` for an example of how to prepare metadata.</span>

<span class="sd">        :param left: The left coordinates (inclusive).</span>
<span class="sd">        :type left: numpy.ndarray, dtype=np.float64</span>
<span class="sd">        :param right: The right coordinates (exclusive).</span>
<span class="sd">        :type right: numpy.ndarray, dtype=np.float64</span>
<span class="sd">        :param node: The node IDs.</span>
<span class="sd">        :type node: numpy.ndarray, dtype=np.int32</span>
<span class="sd">        :param source: The source population IDs.</span>
<span class="sd">        :type source: numpy.ndarray, dtype=np.int32</span>
<span class="sd">        :param dest: The destination population IDs.</span>
<span class="sd">        :type dest: numpy.ndarray, dtype=np.int32</span>
<span class="sd">        :param time: The time of each migration.</span>
<span class="sd">        :type time: numpy.ndarray, dtype=np.int64</span>
<span class="sd">        :param metadata: The flattened metadata array. Must be specified along</span>
<span class="sd">            with ``metadata_offset``. If not specified or None, an empty metadata</span>
<span class="sd">            value is stored for each migration.</span>
<span class="sd">        :type metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param metadata_offset: The offsets into the ``metadata`` array.</span>
<span class="sd">        :type metadata_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        :param metadata_schema: The encoded metadata schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_required_args</span><span class="p">(</span>
            <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span>
                <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span>
                <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
                <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span>
                <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                <span class="n">metadata_offset</span><span class="o">=</span><span class="n">metadata_offset</span><span class="p">,</span>
                <span class="n">metadata_schema</span><span class="o">=</span><span class="n">metadata_schema</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MigrationTable.append_columns"><a class="viewcode-back" href="../../python-api.html#tskit.MigrationTable.append_columns">[docs]</a>    <span class="k">def</span> <span class="nf">append_columns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">left</span><span class="p">,</span>
        <span class="n">right</span><span class="p">,</span>
        <span class="n">node</span><span class="p">,</span>
        <span class="n">source</span><span class="p">,</span>
        <span class="n">dest</span><span class="p">,</span>
        <span class="n">time</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Appends the specified arrays to the end of the columns of this</span>
<span class="sd">        :class:`MigrationTable`. This allows many new rows to be added at once.</span>

<span class="sd">        All parameters except ``metadata`` and ``metadata_offset`` and are mandatory,</span>
<span class="sd">        and must be numpy arrays of the same length (which is equal to the number of</span>
<span class="sd">        additional migrations to add to the table). The ``metadata`` and</span>
<span class="sd">        ``metadata_offset`` parameters must be supplied together, and</span>
<span class="sd">        meet the requirements for :ref:`sec_encoding_ragged_columns`.</span>
<span class="sd">        See :ref:`sec_tables_api_binary_columns` for more information and</span>
<span class="sd">        :ref:`sec_tutorial_metadata_bulk` for an example of how to prepare metadata.</span>

<span class="sd">        :param left: The left coordinates (inclusive).</span>
<span class="sd">        :type left: numpy.ndarray, dtype=np.float64</span>
<span class="sd">        :param right: The right coordinates (exclusive).</span>
<span class="sd">        :type right: numpy.ndarray, dtype=np.float64</span>
<span class="sd">        :param node: The node IDs.</span>
<span class="sd">        :type node: numpy.ndarray, dtype=np.int32</span>
<span class="sd">        :param source: The source population IDs.</span>
<span class="sd">        :type source: numpy.ndarray, dtype=np.int32</span>
<span class="sd">        :param dest: The destination population IDs.</span>
<span class="sd">        :type dest: numpy.ndarray, dtype=np.int32</span>
<span class="sd">        :param time: The time of each migration.</span>
<span class="sd">        :type time: numpy.ndarray, dtype=np.int64</span>
<span class="sd">        :param metadata: The flattened metadata array. Must be specified along</span>
<span class="sd">            with ``metadata_offset``. If not specified or None, an empty metadata</span>
<span class="sd">            value is stored for each migration.</span>
<span class="sd">        :type metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param metadata_offset: The offsets into the ``metadata`` array.</span>
<span class="sd">        :type metadata_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">append_columns</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span>
                <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span>
                <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
                <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span>
                <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                <span class="n">metadata_offset</span><span class="o">=</span><span class="n">metadata_offset</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="SiteTable"><a class="viewcode-back" href="../../python-api.html#tskit.SiteTable">[docs]</a><span class="k">class</span> <span class="nc">SiteTable</span><span class="p">(</span><span class="n">BaseTable</span><span class="p">,</span> <span class="n">MetadataMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A table defining the sites in a tree sequence. See the</span>
<span class="sd">    :ref:`definitions &lt;sec_site_table_definition&gt;` for details on the columns</span>
<span class="sd">    in this table and the</span>
<span class="sd">    :ref:`tree sequence requirements &lt;sec_valid_tree_sequence_requirements&gt;` section</span>
<span class="sd">    for the properties needed for a site table to be a part of a valid tree</span>
<span class="sd">    sequence.</span>

<span class="sd">    :warning: The numpy arrays returned by table attribute accesses are **copies**</span>
<span class="sd">        of the underlying data. In particular, this means that you cannot edit</span>
<span class="sd">        the values in the columns by updating the attribute arrays.</span>

<span class="sd">        **NOTE:** this behaviour may change in future.</span>

<span class="sd">    :ivar position: The array of site position coordinates.</span>
<span class="sd">    :vartype position: numpy.ndarray, dtype=np.float64</span>
<span class="sd">    :ivar ancestral_state: The flattened array of ancestral state strings.</span>
<span class="sd">        See :ref:`sec_tables_api_text_columns` for more details.</span>
<span class="sd">    :vartype ancestral_state: numpy.ndarray, dtype=np.int8</span>
<span class="sd">    :ivar ancestral_state_offset: The offsets of rows in the ancestral_state</span>
<span class="sd">        array. See :ref:`sec_tables_api_text_columns` for more details.</span>
<span class="sd">    :vartype ancestral_state_offset: numpy.ndarray, dtype=np.uint32</span>
<span class="sd">    :ivar metadata: The flattened array of binary metadata values. See</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more details.</span>
<span class="sd">    :vartype metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">    :ivar metadata_offset: The array of offsets into the metadata column. See</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more details.</span>
<span class="sd">    :vartype metadata_offset: numpy.ndarray, dtype=np.uint32</span>
<span class="sd">    :ivar metadata_schema: The metadata schema for this table&#39;s metadata column</span>
<span class="sd">    :vartype metadata_schema: tskit.MetadataSchema</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;position&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ancestral_state&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ancestral_state_offset&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata_offset&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_rows_increment</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ll_table</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ll_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ll_table</span> <span class="o">=</span> <span class="n">_tskit</span><span class="o">.</span><span class="n">SiteTable</span><span class="p">(</span><span class="n">max_rows_increment</span><span class="o">=</span><span class="n">max_rows_increment</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ll_table</span><span class="p">,</span> <span class="n">SiteTableRow</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_text_header_and_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
        <span class="n">ancestral_state</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">unpack_strings</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ancestral_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ancestral_state_offset</span>
        <span class="p">)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">unpack_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_offset</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="s2">&quot;ancestral_state&quot;</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">&lt;=</span> <span class="n">limit</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                <span class="nb">range</span><span class="p">(</span><span class="n">limit</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">-</span> <span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="p">(</span><span class="n">limit</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;__skipped__</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="o">-</span><span class="n">limit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">md</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="se">\t</span><span class="si">{:.8f}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">j</span><span class="p">,</span> <span class="n">position</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">ancestral_state</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">md</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">headers</span><span class="p">,</span> <span class="n">rows</span>

<div class="viewcode-block" id="SiteTable.add_row"><a class="viewcode-back" href="../../python-api.html#tskit.SiteTable.add_row">[docs]</a>    <span class="k">def</span> <span class="nf">add_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">ancestral_state</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new row to this :class:`SiteTable` and returns the ID of the</span>
<span class="sd">        corresponding site. Metadata, if specified, will be validated and encoded</span>
<span class="sd">        according to the table&#39;s</span>
<span class="sd">        :attr:`metadata_schema&lt;tskit.SiteTable.metadata_schema&gt;`.</span>

<span class="sd">        :param float position: The position of this site in genome coordinates.</span>
<span class="sd">        :param str ancestral_state: The state of this site at the root of the tree.</span>
<span class="sd">        :param object metadata: Any object that is valid metadata for the table&#39;s schema.</span>
<span class="sd">        :return: The ID of the newly added site.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_schema</span><span class="o">.</span><span class="n">validate_and_encode_row</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">ancestral_state</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span></div>

<div class="viewcode-block" id="SiteTable.set_columns"><a class="viewcode-back" href="../../python-api.html#tskit.SiteTable.set_columns">[docs]</a>    <span class="k">def</span> <span class="nf">set_columns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ancestral_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ancestral_state_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the values for each column in this :class:`SiteTable` using the values</span>
<span class="sd">        in the specified arrays. Overwrites any data currently stored in the table.</span>

<span class="sd">        The ``position``, ``ancestral_state`` and ``ancestral_state_offset``</span>
<span class="sd">        parameters are mandatory, and must be 1D numpy arrays. The length</span>
<span class="sd">        of the ``position`` array determines the number of rows in table.</span>
<span class="sd">        The ``ancestral_state`` and ``ancestral_state_offset`` parameters must</span>
<span class="sd">        be supplied together, and meet the requirements for</span>
<span class="sd">        :ref:`sec_encoding_ragged_columns` (see</span>
<span class="sd">        :ref:`sec_tables_api_text_columns` for more information). The</span>
<span class="sd">        ``metadata`` and ``metadata_offset`` parameters must be supplied</span>
<span class="sd">        together, and meet the requirements for</span>
<span class="sd">        :ref:`sec_encoding_ragged_columns` (see</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more information) and</span>
<span class="sd">        :ref:`sec_tutorial_metadata_bulk` for an example of how to prepare metadata.</span>

<span class="sd">        :param position: The position of each site in genome coordinates.</span>
<span class="sd">        :type position: numpy.ndarray, dtype=np.float64</span>
<span class="sd">        :param ancestral_state: The flattened ancestral_state array. Required.</span>
<span class="sd">        :type ancestral_state: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param ancestral_state_offset: The offsets into the ``ancestral_state`` array.</span>
<span class="sd">        :type ancestral_state_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        :param metadata: The flattened metadata array. Must be specified along</span>
<span class="sd">            with ``metadata_offset``. If not specified or None, an empty metadata</span>
<span class="sd">            value is stored for each node.</span>
<span class="sd">        :type metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param metadata_offset: The offsets into the ``metadata`` array.</span>
<span class="sd">        :type metadata_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        :param metadata_schema: The encoded metadata schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_required_args</span><span class="p">(</span>
            <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span>
            <span class="n">ancestral_state</span><span class="o">=</span><span class="n">ancestral_state</span><span class="p">,</span>
            <span class="n">ancestral_state_offset</span><span class="o">=</span><span class="n">ancestral_state_offset</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span>
                <span class="n">ancestral_state</span><span class="o">=</span><span class="n">ancestral_state</span><span class="p">,</span>
                <span class="n">ancestral_state_offset</span><span class="o">=</span><span class="n">ancestral_state_offset</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                <span class="n">metadata_offset</span><span class="o">=</span><span class="n">metadata_offset</span><span class="p">,</span>
                <span class="n">metadata_schema</span><span class="o">=</span><span class="n">metadata_schema</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="SiteTable.append_columns"><a class="viewcode-back" href="../../python-api.html#tskit.SiteTable.append_columns">[docs]</a>    <span class="k">def</span> <span class="nf">append_columns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">position</span><span class="p">,</span>
        <span class="n">ancestral_state</span><span class="p">,</span>
        <span class="n">ancestral_state_offset</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Appends the specified arrays to the end of the columns of this</span>
<span class="sd">        :class:`SiteTable`. This allows many new rows to be added at once.</span>

<span class="sd">        The ``position``, ``ancestral_state`` and ``ancestral_state_offset``</span>
<span class="sd">        parameters are mandatory, and must be 1D numpy arrays. The length</span>
<span class="sd">        of the ``position`` array determines the number of additional rows</span>
<span class="sd">        to add the table.</span>
<span class="sd">        The ``ancestral_state`` and ``ancestral_state_offset`` parameters must</span>
<span class="sd">        be supplied together, and meet the requirements for</span>
<span class="sd">        :ref:`sec_encoding_ragged_columns` (see</span>
<span class="sd">        :ref:`sec_tables_api_text_columns` for more information). The</span>
<span class="sd">        ``metadata`` and ``metadata_offset`` parameters must be supplied</span>
<span class="sd">        together, and meet the requirements for</span>
<span class="sd">        :ref:`sec_encoding_ragged_columns` (see</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more information) and</span>
<span class="sd">        :ref:`sec_tutorial_metadata_bulk` for an example of how to prepare metadata.</span>

<span class="sd">        :param position: The position of each site in genome coordinates.</span>
<span class="sd">        :type position: numpy.ndarray, dtype=np.float64</span>
<span class="sd">        :param ancestral_state: The flattened ancestral_state array. Required.</span>
<span class="sd">        :type ancestral_state: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param ancestral_state_offset: The offsets into the ``ancestral_state`` array.</span>
<span class="sd">        :type ancestral_state_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        :param metadata: The flattened metadata array. Must be specified along</span>
<span class="sd">            with ``metadata_offset``. If not specified or None, an empty metadata</span>
<span class="sd">            value is stored for each node.</span>
<span class="sd">        :type metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param metadata_offset: The offsets into the ``metadata`` array.</span>
<span class="sd">        :type metadata_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">append_columns</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span>
                <span class="n">ancestral_state</span><span class="o">=</span><span class="n">ancestral_state</span><span class="p">,</span>
                <span class="n">ancestral_state_offset</span><span class="o">=</span><span class="n">ancestral_state_offset</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                <span class="n">metadata_offset</span><span class="o">=</span><span class="n">metadata_offset</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="SiteTable.packset_ancestral_state"><a class="viewcode-back" href="../../python-api.html#tskit.SiteTable.packset_ancestral_state">[docs]</a>    <span class="k">def</span> <span class="nf">packset_ancestral_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ancestral_states</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Packs the specified list of ancestral_state values and updates the</span>
<span class="sd">        ``ancestral_state`` and ``ancestral_state_offset`` columns. The length</span>
<span class="sd">        of the ancestral_states array must be equal to the number of rows in</span>
<span class="sd">        the table.</span>

<span class="sd">        :param list(str) ancestral_states: A list of string ancestral state values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">packed</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">pack_strings</span><span class="p">(</span><span class="n">ancestral_states</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;ancestral_state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">packed</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;ancestral_state_offset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MutationTable"><a class="viewcode-back" href="../../python-api.html#tskit.MutationTable">[docs]</a><span class="k">class</span> <span class="nc">MutationTable</span><span class="p">(</span><span class="n">BaseTable</span><span class="p">,</span> <span class="n">MetadataMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A table defining the mutations in a tree sequence. See the</span>
<span class="sd">    :ref:`definitions &lt;sec_mutation_table_definition&gt;` for details on the columns</span>
<span class="sd">    in this table and the</span>
<span class="sd">    :ref:`tree sequence requirements &lt;sec_valid_tree_sequence_requirements&gt;` section</span>
<span class="sd">    for the properties needed for a mutation table to be a part of a valid tree</span>
<span class="sd">    sequence.</span>

<span class="sd">    :warning: The numpy arrays returned by table attribute accesses are **copies**</span>
<span class="sd">        of the underlying data. In particular, this means that you cannot edit</span>
<span class="sd">        the values in the columns by updating the attribute arrays.</span>

<span class="sd">        **NOTE:** this behaviour may change in future.</span>

<span class="sd">    :ivar site: The array of site IDs.</span>
<span class="sd">    :vartype site: numpy.ndarray, dtype=np.int32</span>
<span class="sd">    :ivar node: The array of node IDs.</span>
<span class="sd">    :vartype node: numpy.ndarray, dtype=np.int32</span>
<span class="sd">    :ivar time: The array of time values.</span>
<span class="sd">    :vartype time: numpy.ndarray, dtype=np.float64</span>
<span class="sd">    :ivar derived_state: The flattened array of derived state strings.</span>
<span class="sd">        See :ref:`sec_tables_api_text_columns` for more details.</span>
<span class="sd">    :vartype derived_state: numpy.ndarray, dtype=np.int8</span>
<span class="sd">    :ivar derived_state_offset: The offsets of rows in the derived_state</span>
<span class="sd">        array. See :ref:`sec_tables_api_text_columns` for more details.</span>
<span class="sd">    :vartype derived_state_offset: numpy.ndarray, dtype=np.uint32</span>
<span class="sd">    :ivar parent: The array of parent mutation IDs.</span>
<span class="sd">    :vartype parent: numpy.ndarray, dtype=np.int32</span>
<span class="sd">    :ivar metadata: The flattened array of binary metadata values. See</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more details.</span>
<span class="sd">    :vartype metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">    :ivar metadata_offset: The array of offsets into the metadata column. See</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more details.</span>
<span class="sd">    :vartype metadata_offset: numpy.ndarray, dtype=np.uint32</span>
<span class="sd">    :ivar metadata_schema: The metadata schema for this table&#39;s metadata column</span>
<span class="sd">    :vartype metadata_schema: tskit.MetadataSchema</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;site&quot;</span><span class="p">,</span>
        <span class="s2">&quot;node&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;derived_state&quot;</span><span class="p">,</span>
        <span class="s2">&quot;derived_state_offset&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata&quot;</span><span class="p">,</span>
        <span class="s2">&quot;metadata_offset&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_rows_increment</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ll_table</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ll_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ll_table</span> <span class="o">=</span> <span class="n">_tskit</span><span class="o">.</span><span class="n">MutationTable</span><span class="p">(</span><span class="n">max_rows_increment</span><span class="o">=</span><span class="n">max_rows_increment</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ll_table</span><span class="p">,</span> <span class="n">MutationTableRow</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_text_header_and_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">site</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
        <span class="n">derived_state</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">unpack_strings</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">derived_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">derived_state_offset</span>
        <span class="p">)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">unpack_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_offset</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;site&quot;</span><span class="p">,</span> <span class="s2">&quot;node&quot;</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;derived_state&quot;</span><span class="p">,</span> <span class="s2">&quot;parent&quot;</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">&lt;=</span> <span class="n">limit</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                <span class="nb">range</span><span class="p">(</span><span class="n">limit</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">-</span> <span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="p">(</span><span class="n">limit</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;__skipped__</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="o">-</span><span class="n">limit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">md</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="se">\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">j</span><span class="p">,</span> <span class="n">site</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">node</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">time</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">derived_state</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">parent</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">md</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">headers</span><span class="p">,</span> <span class="n">rows</span>

<div class="viewcode-block" id="MutationTable.add_row"><a class="viewcode-back" href="../../python-api.html#tskit.MutationTable.add_row">[docs]</a>    <span class="k">def</span> <span class="nf">add_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">site</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">derived_state</span><span class="p">,</span> <span class="n">parent</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new row to this :class:`MutationTable` and returns the ID of the</span>
<span class="sd">        corresponding mutation. Metadata, if specified, will be validated and encoded</span>
<span class="sd">        according to the table&#39;s</span>
<span class="sd">        :attr:`metadata_schema&lt;tskit.MutationTable.metadata_schema&gt;`.</span>

<span class="sd">        :param int site: The ID of the site that this mutation occurs at.</span>
<span class="sd">        :param int node: The ID of the first node inheriting this mutation.</span>
<span class="sd">        :param str derived_state: The state of the site at this mutation&#39;s node.</span>
<span class="sd">        :param int parent: The ID of the parent mutation. If not specified,</span>
<span class="sd">            defaults to :attr:`NULL`.</span>
<span class="sd">        :param object metadata: Any object that is valid metadata for the table&#39;s schema.</span>
<span class="sd">        :return: The ID of the newly added mutation.</span>
<span class="sd">        :param float time: The occurrence time for the new mutation. If not specified,</span>
<span class="sd">            defaults to ``UNKNOWN_TIME``, indicating the time is unknown.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_schema</span><span class="o">.</span><span class="n">validate_and_encode_row</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
            <span class="n">site</span><span class="p">,</span>
            <span class="n">node</span><span class="p">,</span>
            <span class="n">derived_state</span><span class="p">,</span>
            <span class="n">parent</span><span class="p">,</span>
            <span class="n">metadata</span><span class="p">,</span>
            <span class="n">UNKNOWN_TIME</span> <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">time</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MutationTable.set_columns"><a class="viewcode-back" href="../../python-api.html#tskit.MutationTable.set_columns">[docs]</a>    <span class="k">def</span> <span class="nf">set_columns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">site</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">derived_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">derived_state_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_schema</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the values for each column in this :class:`MutationTable` using the values</span>
<span class="sd">        in the specified arrays. Overwrites any data currently stored in the table.</span>

<span class="sd">        The ``site``, ``node``, ``derived_state`` and ``derived_state_offset``</span>
<span class="sd">        parameters are mandatory, and must be 1D numpy arrays. The</span>
<span class="sd">        ``site`` and ``node`` (also ``parent`` and ``time``, if supplied) arrays</span>
<span class="sd">        must be of equal length, and determine the number of rows in the table.</span>
<span class="sd">        The ``derived_state`` and ``derived_state_offset`` parameters must</span>
<span class="sd">        be supplied together, and meet the requirements for</span>
<span class="sd">        :ref:`sec_encoding_ragged_columns` (see</span>
<span class="sd">        :ref:`sec_tables_api_text_columns` for more information). The</span>
<span class="sd">        ``metadata`` and ``metadata_offset`` parameters must be supplied</span>
<span class="sd">        together, and meet the requirements for</span>
<span class="sd">        :ref:`sec_encoding_ragged_columns` (see</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more information) and</span>
<span class="sd">        :ref:`sec_tutorial_metadata_bulk` for an example of how to prepare metadata.</span>

<span class="sd">        :param site: The ID of the site each mutation occurs at.</span>
<span class="sd">        :type site: numpy.ndarray, dtype=np.int32</span>
<span class="sd">        :param node: The ID of the node each mutation is associated with.</span>
<span class="sd">        :type node: numpy.ndarray, dtype=np.int32</span>
<span class="sd">        :param time: The time values for each mutation.</span>
<span class="sd">        :type time: numpy.ndarray, dtype=np.float64</span>
<span class="sd">        :param derived_state: The flattened derived_state array. Required.</span>
<span class="sd">        :type derived_state: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param derived_state_offset: The offsets into the ``derived_state`` array.</span>
<span class="sd">        :type derived_state_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        :param parent: The ID of the parent mutation for each mutation.</span>
<span class="sd">        :type parent: numpy.ndarray, dtype=np.int32</span>
<span class="sd">        :param metadata: The flattened metadata array. Must be specified along</span>
<span class="sd">            with ``metadata_offset``. If not specified or None, an empty metadata</span>
<span class="sd">            value is stored for each node.</span>
<span class="sd">        :type metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param metadata_offset: The offsets into the ``metadata`` array.</span>
<span class="sd">        :type metadata_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        :param metadata_schema: The encoded metadata schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_required_args</span><span class="p">(</span>
            <span class="n">site</span><span class="o">=</span><span class="n">site</span><span class="p">,</span>
            <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
            <span class="n">derived_state</span><span class="o">=</span><span class="n">derived_state</span><span class="p">,</span>
            <span class="n">derived_state_offset</span><span class="o">=</span><span class="n">derived_state_offset</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">site</span><span class="o">=</span><span class="n">site</span><span class="p">,</span>
                <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
                <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
                <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
                <span class="n">derived_state</span><span class="o">=</span><span class="n">derived_state</span><span class="p">,</span>
                <span class="n">derived_state_offset</span><span class="o">=</span><span class="n">derived_state_offset</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                <span class="n">metadata_offset</span><span class="o">=</span><span class="n">metadata_offset</span><span class="p">,</span>
                <span class="n">metadata_schema</span><span class="o">=</span><span class="n">metadata_schema</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MutationTable.append_columns"><a class="viewcode-back" href="../../python-api.html#tskit.MutationTable.append_columns">[docs]</a>    <span class="k">def</span> <span class="nf">append_columns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">site</span><span class="p">,</span>
        <span class="n">node</span><span class="p">,</span>
        <span class="n">derived_state</span><span class="p">,</span>
        <span class="n">derived_state_offset</span><span class="p">,</span>
        <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">metadata_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Appends the specified arrays to the end of the columns of this</span>
<span class="sd">        :class:`MutationTable`. This allows many new rows to be added at once.</span>

<span class="sd">        The ``site``, ``node``, ``derived_state`` and ``derived_state_offset``</span>
<span class="sd">        parameters are mandatory, and must be 1D numpy arrays. The</span>
<span class="sd">        ``site`` and ``node`` (also ``time`` and ``parent``, if supplied) arrays</span>
<span class="sd">        must be of equal length, and determine the number of additional</span>
<span class="sd">        rows to add to the table.</span>
<span class="sd">        The ``derived_state`` and ``derived_state_offset`` parameters must</span>
<span class="sd">        be supplied together, and meet the requirements for</span>
<span class="sd">        :ref:`sec_encoding_ragged_columns` (see</span>
<span class="sd">        :ref:`sec_tables_api_text_columns` for more information). The</span>
<span class="sd">        ``metadata`` and ``metadata_offset`` parameters must be supplied</span>
<span class="sd">        together, and meet the requirements for</span>
<span class="sd">        :ref:`sec_encoding_ragged_columns` (see</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more information) and</span>
<span class="sd">        :ref:`sec_tutorial_metadata_bulk` for an example of how to prepare metadata.</span>

<span class="sd">        :param site: The ID of the site each mutation occurs at.</span>
<span class="sd">        :type site: numpy.ndarray, dtype=np.int32</span>
<span class="sd">        :param node: The ID of the node each mutation is associated with.</span>
<span class="sd">        :type node: numpy.ndarray, dtype=np.int32</span>
<span class="sd">        :param time: The time values for each mutation.</span>
<span class="sd">        :type time: numpy.ndarray, dtype=np.float64</span>
<span class="sd">        :param derived_state: The flattened derived_state array. Required.</span>
<span class="sd">        :type derived_state: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param derived_state_offset: The offsets into the ``derived_state`` array.</span>
<span class="sd">        :type derived_state_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        :param parent: The ID of the parent mutation for each mutation.</span>
<span class="sd">        :type parent: numpy.ndarray, dtype=np.int32</span>
<span class="sd">        :param metadata: The flattened metadata array. Must be specified along</span>
<span class="sd">            with ``metadata_offset``. If not specified or None, an empty metadata</span>
<span class="sd">            value is stored for each node.</span>
<span class="sd">        :type metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param metadata_offset: The offsets into the ``metadata`` array.</span>
<span class="sd">        :type metadata_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">append_columns</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">site</span><span class="o">=</span><span class="n">site</span><span class="p">,</span>
                <span class="n">node</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
                <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span>
                <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
                <span class="n">derived_state</span><span class="o">=</span><span class="n">derived_state</span><span class="p">,</span>
                <span class="n">derived_state_offset</span><span class="o">=</span><span class="n">derived_state_offset</span><span class="p">,</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                <span class="n">metadata_offset</span><span class="o">=</span><span class="n">metadata_offset</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="MutationTable.packset_derived_state"><a class="viewcode-back" href="../../python-api.html#tskit.MutationTable.packset_derived_state">[docs]</a>    <span class="k">def</span> <span class="nf">packset_derived_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">derived_states</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Packs the specified list of derived_state values and updates the</span>
<span class="sd">        ``derived_state`` and ``derived_state_offset`` columns. The length</span>
<span class="sd">        of the derived_states array must be equal to the number of rows in</span>
<span class="sd">        the table.</span>

<span class="sd">        :param list(str) derived_states: A list of string derived state values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">packed</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">pack_strings</span><span class="p">(</span><span class="n">derived_states</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;derived_state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">packed</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;derived_state_offset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PopulationTable"><a class="viewcode-back" href="../../python-api.html#tskit.PopulationTable">[docs]</a><span class="k">class</span> <span class="nc">PopulationTable</span><span class="p">(</span><span class="n">BaseTable</span><span class="p">,</span> <span class="n">MetadataMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A table defining the populations referred to in a tree sequence.</span>
<span class="sd">    The PopulationTable stores metadata for populations that may be referred to</span>
<span class="sd">    in the NodeTable and MigrationTable&quot;.  Note that although nodes</span>
<span class="sd">    may be associated with populations, this association is stored in</span>
<span class="sd">    the :class:`NodeTable`: only metadata on each population is stored</span>
<span class="sd">    in the population table.</span>

<span class="sd">    :warning: The numpy arrays returned by table attribute accesses are **copies**</span>
<span class="sd">        of the underlying data. In particular, this means that you cannot edit</span>
<span class="sd">        the values in the columns by updating the attribute arrays.</span>

<span class="sd">        **NOTE:** this behaviour may change in future.</span>

<span class="sd">    :ivar metadata: The flattened array of binary metadata values. See</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more details.</span>
<span class="sd">    :vartype metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">    :ivar metadata_offset: The array of offsets into the metadata column. See</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more details.</span>
<span class="sd">    :vartype metadata_offset: numpy.ndarray, dtype=np.uint32</span>
<span class="sd">    :ivar metadata_schema: The metadata schema for this table&#39;s metadata column</span>
<span class="sd">    :vartype metadata_schema: tskit.MetadataSchema</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">,</span> <span class="s2">&quot;metadata_offset&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_rows_increment</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ll_table</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ll_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ll_table</span> <span class="o">=</span> <span class="n">_tskit</span><span class="o">.</span><span class="n">PopulationTable</span><span class="p">(</span><span class="n">max_rows_increment</span><span class="o">=</span><span class="n">max_rows_increment</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ll_table</span><span class="p">,</span> <span class="n">PopulationTableRow</span><span class="p">)</span>

<div class="viewcode-block" id="PopulationTable.add_row"><a class="viewcode-back" href="../../python-api.html#tskit.PopulationTable.add_row">[docs]</a>    <span class="k">def</span> <span class="nf">add_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new row to this :class:`PopulationTable` and returns the ID of the</span>
<span class="sd">        corresponding population. Metadata, if specified, will be validated and encoded</span>
<span class="sd">        according to the table&#39;s</span>
<span class="sd">        :attr:`metadata_schema&lt;tskit.PopulationTable.metadata_schema&gt;`.</span>

<span class="sd">        :param object metadata: Any object that is valid metadata for the table&#39;s schema.</span>
<span class="sd">        :return: The ID of the newly added population.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_schema</span><span class="o">.</span><span class="n">validate_and_encode_row</span><span class="p">(</span><span class="n">metadata</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_text_header_and_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">unpack_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_offset</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;metadata&quot;</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">&lt;=</span> <span class="n">limit</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                <span class="nb">range</span><span class="p">(</span><span class="n">limit</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">-</span> <span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="p">(</span><span class="n">limit</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;__skipped__</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="o">-</span><span class="n">limit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">md</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">md</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">headers</span><span class="p">,</span> <span class="n">rows</span>

<div class="viewcode-block" id="PopulationTable.set_columns"><a class="viewcode-back" href="../../python-api.html#tskit.PopulationTable.set_columns">[docs]</a>    <span class="k">def</span> <span class="nf">set_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata_schema</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the values for each column in this :class:`PopulationTable` using the</span>
<span class="sd">        values in the specified arrays. Overwrites any data currently stored in the</span>
<span class="sd">        table.</span>

<span class="sd">        The ``metadata`` and ``metadata_offset`` parameters must be supplied</span>
<span class="sd">        together, and meet the requirements for</span>
<span class="sd">        :ref:`sec_encoding_ragged_columns` (see</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more information) and</span>
<span class="sd">        :ref:`sec_tutorial_metadata_bulk` for an example of how to prepare metadata.</span>

<span class="sd">        :param metadata: The flattened metadata array. Must be specified along</span>
<span class="sd">            with ``metadata_offset``. If not specified or None, an empty metadata</span>
<span class="sd">            value is stored for each node.</span>
<span class="sd">        :type metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param metadata_offset: The offsets into the ``metadata`` array.</span>
<span class="sd">        :type metadata_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        :param metadata_schema: The encoded metadata schema.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span>
                <span class="n">metadata_offset</span><span class="o">=</span><span class="n">metadata_offset</span><span class="p">,</span>
                <span class="n">metadata_schema</span><span class="o">=</span><span class="n">metadata_schema</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="PopulationTable.append_columns"><a class="viewcode-back" href="../../python-api.html#tskit.PopulationTable.append_columns">[docs]</a>    <span class="k">def</span> <span class="nf">append_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Appends the specified arrays to the end of the columns of this</span>
<span class="sd">        :class:`PopulationTable`. This allows many new rows to be added at once.</span>

<span class="sd">        The ``metadata`` and ``metadata_offset`` parameters must be supplied</span>
<span class="sd">        together, and meet the requirements for</span>
<span class="sd">        :ref:`sec_encoding_ragged_columns` (see</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more information) and</span>
<span class="sd">        :ref:`sec_tutorial_metadata_bulk` for an example of how to prepare metadata.</span>

<span class="sd">        :param metadata: The flattened metadata array. Must be specified along</span>
<span class="sd">            with ``metadata_offset``. If not specified or None, an empty metadata</span>
<span class="sd">            value is stored for each node.</span>
<span class="sd">        :type metadata: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param metadata_offset: The offsets into the ``metadata`` array.</span>
<span class="sd">        :type metadata_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">append_columns</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span> <span class="n">metadata_offset</span><span class="o">=</span><span class="n">metadata_offset</span><span class="p">)</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="ProvenanceTable"><a class="viewcode-back" href="../../python-api.html#tskit.ProvenanceTable">[docs]</a><span class="k">class</span> <span class="nc">ProvenanceTable</span><span class="p">(</span><span class="n">BaseTable</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A table recording the provenance (i.e., history) of this table, so that the</span>
<span class="sd">    origin of the underlying data and sequence of subsequent operations can be</span>
<span class="sd">    traced. Each row contains a &quot;record&quot; string (recommended format: JSON) and</span>
<span class="sd">    a timestamp.</span>

<span class="sd">    .. todo::</span>
<span class="sd">        The format of the `record` field will be more precisely specified in</span>
<span class="sd">        the future.</span>

<span class="sd">    :ivar record: The flattened array containing the record strings.</span>
<span class="sd">        :ref:`sec_tables_api_text_columns` for more details.</span>
<span class="sd">    :vartype record: numpy.ndarray, dtype=np.int8</span>
<span class="sd">    :ivar record_offset: The array of offsets into the record column. See</span>
<span class="sd">        :ref:`sec_tables_api_text_columns` for more details.</span>
<span class="sd">    :vartype record_offset: numpy.ndarray, dtype=np.uint32</span>
<span class="sd">    :ivar timestamp: The flattened array containing the timestamp strings.</span>
<span class="sd">        :ref:`sec_tables_api_text_columns` for more details.</span>
<span class="sd">    :vartype timestamp: numpy.ndarray, dtype=np.int8</span>
<span class="sd">    :ivar timestamp_offset: The array of offsets into the timestamp column. See</span>
<span class="sd">        :ref:`sec_tables_api_text_columns` for more details.</span>
<span class="sd">    :vartype timestamp_offset: numpy.ndarray, dtype=np.uint32</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;record&quot;</span><span class="p">,</span> <span class="s2">&quot;record_offset&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp_offset&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_rows_increment</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ll_table</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ll_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ll_table</span> <span class="o">=</span> <span class="n">_tskit</span><span class="o">.</span><span class="n">ProvenanceTable</span><span class="p">(</span><span class="n">max_rows_increment</span><span class="o">=</span><span class="n">max_rows_increment</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ll_table</span><span class="p">,</span> <span class="n">ProvenanceTableRow</span><span class="p">)</span>

<div class="viewcode-block" id="ProvenanceTable.equals"><a class="viewcode-back" href="../../python-api.html#tskit.ProvenanceTable.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">ignore_timestamps</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if  `self` and `other` are equal. By default, two provenance</span>
<span class="sd">        tables are considered equal if their columns are byte-for-byte identical.</span>

<span class="sd">        :param other: Another provenance table instance</span>
<span class="sd">        :param bool ignore_timestamps: If True exclude the timestamp column</span>
<span class="sd">            from the comparison.</span>
<span class="sd">        :return: True if other is equal to this provenance table; False otherwise.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span>
                    <span class="n">other</span><span class="o">.</span><span class="n">ll_table</span><span class="p">,</span> <span class="n">ignore_timestamps</span><span class="o">=</span><span class="n">ignore_timestamps</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="ProvenanceTable.add_row"><a class="viewcode-back" href="../../python-api.html#tskit.ProvenanceTable.add_row">[docs]</a>    <span class="k">def</span> <span class="nf">add_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a new row to this ProvenanceTable consisting of the specified record and</span>
<span class="sd">        timestamp. If timestamp is not specified, it is automatically generated from</span>
<span class="sd">        the current time.</span>

<span class="sd">        :param str record: A provenance record, describing the parameters and</span>
<span class="sd">            environment used to generate the current set of tables.</span>
<span class="sd">        :param str timestamp: A string timestamp. This should be in ISO8601 form.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="c1"># Note that the order of the positional arguments has been reversed</span>
        <span class="c1"># from the low-level module, which is a bit confusing. However, we</span>
        <span class="c1"># want the default behaviour here to be to add a row to the table at</span>
        <span class="c1"># the current time as simply as possible.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span><span class="n">record</span><span class="o">=</span><span class="n">record</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProvenanceTable.set_columns"><a class="viewcode-back" href="../../python-api.html#tskit.ProvenanceTable.set_columns">[docs]</a>    <span class="k">def</span> <span class="nf">set_columns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timestamp_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">record_offset</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the values for each column in this :class:`ProvenanceTable` using the</span>
<span class="sd">        values in the specified arrays. Overwrites any data currently stored in the</span>
<span class="sd">        table.</span>

<span class="sd">        The ``timestamp`` and ``timestamp_offset`` parameters must be supplied</span>
<span class="sd">        together, and meet the requirements for</span>
<span class="sd">        :ref:`sec_encoding_ragged_columns` (see</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more information). Likewise</span>
<span class="sd">        for the ``record`` and ``record_offset`` columns</span>

<span class="sd">        :param timestamp: The flattened timestamp array. Must be specified along</span>
<span class="sd">            with ``timestamp_offset``. If not specified or None, an empty timestamp</span>
<span class="sd">            value is stored for each node.</span>
<span class="sd">        :type timestamp: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param timestamp_offset: The offsets into the ``timestamp`` array.</span>
<span class="sd">        :type timestamp_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        :param record: The flattened record array. Must be specified along</span>
<span class="sd">            with ``record_offset``. If not specified or None, an empty record</span>
<span class="sd">            value is stored for each node.</span>
<span class="sd">        :type record: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param record_offset: The offsets into the ``record`` array.</span>
<span class="sd">        :type record_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span>
                <span class="n">timestamp_offset</span><span class="o">=</span><span class="n">timestamp_offset</span><span class="p">,</span>
                <span class="n">record</span><span class="o">=</span><span class="n">record</span><span class="p">,</span>
                <span class="n">record_offset</span><span class="o">=</span><span class="n">record_offset</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ProvenanceTable.append_columns"><a class="viewcode-back" href="../../python-api.html#tskit.ProvenanceTable.append_columns">[docs]</a>    <span class="k">def</span> <span class="nf">append_columns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">timestamp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timestamp_offset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">record_offset</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Appends the specified arrays to the end of the columns of this</span>
<span class="sd">        :class:`ProvenanceTable`. This allows many new rows to be added at once.</span>

<span class="sd">        The ``timestamp`` and ``timestamp_offset`` parameters must be supplied</span>
<span class="sd">        together, and meet the requirements for</span>
<span class="sd">        :ref:`sec_encoding_ragged_columns` (see</span>
<span class="sd">        :ref:`sec_tables_api_binary_columns` for more information). Likewise</span>
<span class="sd">        for the ``record`` and ``record_offset`` columns</span>

<span class="sd">        :param timestamp: The flattened timestamp array. Must be specified along</span>
<span class="sd">            with ``timestamp_offset``. If not specified or None, an empty timestamp</span>
<span class="sd">            value is stored for each node.</span>
<span class="sd">        :type timestamp: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param timestamp_offset: The offsets into the ``timestamp`` array.</span>
<span class="sd">        :type timestamp_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        :param record: The flattened record array. Must be specified along</span>
<span class="sd">            with ``record_offset``. If not specified or None, an empty record</span>
<span class="sd">            value is stored for each node.</span>
<span class="sd">        :type record: numpy.ndarray, dtype=np.int8</span>
<span class="sd">        :param record_offset: The offsets into the ``record`` array.</span>
<span class="sd">        :type record_offset: numpy.ndarray, dtype=np.uint32.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ll_table</span><span class="o">.</span><span class="n">append_columns</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span>
                <span class="n">timestamp</span><span class="o">=</span><span class="n">timestamp</span><span class="p">,</span>
                <span class="n">timestamp_offset</span><span class="o">=</span><span class="n">timestamp_offset</span><span class="p">,</span>
                <span class="n">record</span><span class="o">=</span><span class="n">record</span><span class="p">,</span>
                <span class="n">record_offset</span><span class="o">=</span><span class="n">record_offset</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_text_header_and_rows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">unpack_strings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_offset</span><span class="p">)</span>
        <span class="n">record</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">unpack_strings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">record</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">record_offset</span><span class="p">)</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="s2">&quot;record&quot;</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">limit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">&lt;=</span> <span class="n">limit</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">indexes</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span>
                <span class="nb">range</span><span class="p">(</span><span class="n">limit</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span>
                <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">-</span> <span class="p">(</span><span class="n">limit</span> <span class="o">-</span> <span class="p">(</span><span class="n">limit</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)),</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">indexes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;__skipped__</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rows</span><span class="o">-</span><span class="n">limit</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">timestamp</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="n">j</span><span class="p">])))</span>
        <span class="k">return</span> <span class="n">headers</span><span class="p">,</span> <span class="n">rows</span>

<div class="viewcode-block" id="ProvenanceTable.packset_record"><a class="viewcode-back" href="../../python-api.html#tskit.ProvenanceTable.packset_record">[docs]</a>    <span class="k">def</span> <span class="nf">packset_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Packs the specified list of record values and updates the</span>
<span class="sd">        ``record`` and ``record_offset`` columns. The length</span>
<span class="sd">        of the records array must be equal to the number of rows in</span>
<span class="sd">        the table.</span>

<span class="sd">        :param list(str) records: A list of string record values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">packed</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">pack_strings</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;record&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">packed</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;record_offset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProvenanceTable.packset_timestamp"><a class="viewcode-back" href="../../python-api.html#tskit.ProvenanceTable.packset_timestamp">[docs]</a>    <span class="k">def</span> <span class="nf">packset_timestamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Packs the specified list of timestamp values and updates the</span>
<span class="sd">        ``timestamp`` and ``timestamp_offset`` columns. The length</span>
<span class="sd">        of the timestamps array must be equal to the number of rows in</span>
<span class="sd">        the table.</span>

<span class="sd">        :param list(str) timestamps: A list of string timestamp values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">packed</span><span class="p">,</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">pack_strings</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">packed</span>
        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;timestamp_offset&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TableCollection"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection">[docs]</a><span class="k">class</span> <span class="nc">TableCollection</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A collection of mutable tables defining a tree sequence. See the</span>
<span class="sd">    :ref:`sec_data_model` section for definition on the various tables</span>
<span class="sd">    and how they together define a :class:`TreeSequence`. Arbitrary</span>
<span class="sd">    data can be stored in a TableCollection, but there are certain</span>
<span class="sd">    :ref:`requirements &lt;sec_valid_tree_sequence_requirements&gt;` that must be</span>
<span class="sd">    satisfied for these tables to be interpreted as a tree sequence.</span>

<span class="sd">    To obtain an immutable :class:`TreeSequence` instance corresponding to the</span>
<span class="sd">    current state of a ``TableCollection``, please use the :meth:`.tree_sequence`</span>
<span class="sd">    method.</span>

<span class="sd">    :ivar individuals: The individual table.</span>
<span class="sd">    :vartype individuals: IndividualTable</span>
<span class="sd">    :ivar nodes: The node table.</span>
<span class="sd">    :vartype nodes: NodeTable</span>
<span class="sd">    :ivar edges: The edge table.</span>
<span class="sd">    :vartype edges: EdgeTable</span>
<span class="sd">    :ivar migrations: The migration table.</span>
<span class="sd">    :vartype migrations: MigrationTable</span>
<span class="sd">    :ivar sites: The site table.</span>
<span class="sd">    :vartype sites: SiteTable</span>
<span class="sd">    :ivar mutations: The mutation table.</span>
<span class="sd">    :vartype mutations: MutationTable</span>
<span class="sd">    :ivar populations: The population table.</span>
<span class="sd">    :vartype populations: PopulationTable</span>
<span class="sd">    :ivar provenances: The provenance table.</span>
<span class="sd">    :vartype provenances: ProvenanceTable</span>
<span class="sd">    :ivar index: The edge insertion and removal index.</span>
<span class="sd">    :ivar sequence_length: The sequence length defining the coordinate</span>
<span class="sd">        space.</span>
<span class="sd">    :vartype sequence_length: float</span>
<span class="sd">    :ivar file_uuid: The UUID for the file this TableCollection is derived</span>
<span class="sd">        from, or None if not derived from a file.</span>
<span class="sd">    :vartype file_uuid: str</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequence_length</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span> <span class="o">=</span> <span class="n">_tskit</span><span class="o">.</span><span class="n">TableCollection</span><span class="p">(</span><span class="n">sequence_length</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">individuals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">IndividualTable</span><span class="p">(</span><span class="n">ll_table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">individuals</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NodeTable</span><span class="p">(</span><span class="n">ll_table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">EdgeTable</span><span class="p">(</span><span class="n">ll_table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">migrations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MigrationTable</span><span class="p">(</span><span class="n">ll_table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">migrations</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sites</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SiteTable</span><span class="p">(</span><span class="n">ll_table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">sites</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mutations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">MutationTable</span><span class="p">(</span><span class="n">ll_table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">mutations</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">populations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">PopulationTable</span><span class="p">(</span><span class="n">ll_table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">populations</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">provenances</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ProvenanceTable</span><span class="p">(</span><span class="n">ll_table</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">provenances</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">indexes</span>
        <span class="k">return</span> <span class="n">TableCollectionIndexes</span><span class="p">(</span><span class="o">**</span><span class="n">indexes</span><span class="p">)</span>

    <span class="nd">@indexes</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indexes</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">indexes</span> <span class="o">=</span> <span class="n">indexes</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sequence_length</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">sequence_length</span>

    <span class="nd">@sequence_length</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">sequence_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequence_length</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">sequence_length</span> <span class="o">=</span> <span class="n">sequence_length</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">file_uuid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">file_uuid</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">metadata_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">metadata</span><span class="o">.</span><span class="n">MetadataSchema</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The :class:`tskit.MetadataSchema` for this TableCollection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">metadata</span><span class="o">.</span><span class="n">parse_metadata_schema</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">metadata_schema</span><span class="p">)</span>

    <span class="nd">@metadata_schema</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">metadata_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">metadata</span><span class="o">.</span><span class="n">MetadataSchema</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Check the schema is a valid schema instance by roundtripping it.</span>
        <span class="n">metadata</span><span class="o">.</span><span class="n">parse_metadata_schema</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">schema</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">metadata_schema</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The decoded metadata for this TableCollection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_schema</span><span class="o">.</span><span class="n">decode_row</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>

    <span class="nd">@metadata</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_schema</span><span class="o">.</span><span class="n">validate_and_encode_row</span><span class="p">(</span>
            <span class="n">metadata</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">metadata_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The raw bytes of metadata for this TableCollection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">metadata</span>

<div class="viewcode-block" id="TableCollection.asdict"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.asdict">[docs]</a>    <span class="k">def</span> <span class="nf">asdict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dictionary representation of this TableCollection.</span>

<span class="sd">        Note: the semantics of this method changed at tskit 0.1.0. Previously a</span>
<span class="sd">        map of table names to the tables themselves was returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;encoding_version&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="s2">&quot;sequence_length&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence_length</span><span class="p">,</span>
            <span class="s2">&quot;metadata_schema&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_schema</span><span class="p">),</span>
            <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_schema</span><span class="o">.</span><span class="n">encode_row</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="p">),</span>
            <span class="s2">&quot;individuals&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">individuals</span><span class="o">.</span><span class="n">asdict</span><span class="p">(),</span>
            <span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">asdict</span><span class="p">(),</span>
            <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">asdict</span><span class="p">(),</span>
            <span class="s2">&quot;migrations&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">migrations</span><span class="o">.</span><span class="n">asdict</span><span class="p">(),</span>
            <span class="s2">&quot;sites&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">asdict</span><span class="p">(),</span>
            <span class="s2">&quot;mutations&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutations</span><span class="o">.</span><span class="n">asdict</span><span class="p">(),</span>
            <span class="s2">&quot;populations&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="o">.</span><span class="n">asdict</span><span class="p">(),</span>
            <span class="s2">&quot;provenances&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">provenances</span><span class="o">.</span><span class="n">asdict</span><span class="p">(),</span>
            <span class="s2">&quot;indexes&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">asdict</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">ret</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a dictionary mapping table names to the corresponding</span>
<span class="sd">        table instances. For example, the returned dictionary will contain the</span>
<span class="sd">        key &quot;edges&quot; that maps to an :class:`.EdgeTable` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">,</span>
            <span class="s2">&quot;individuals&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">individuals</span><span class="p">,</span>
            <span class="s2">&quot;migrations&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">migrations</span><span class="p">,</span>
            <span class="s2">&quot;mutations&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutations</span><span class="p">,</span>
            <span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">,</span>
            <span class="s2">&quot;populations&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="p">,</span>
            <span class="s2">&quot;provenances&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">provenances</span><span class="p">,</span>
            <span class="s2">&quot;sites&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nbytes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the total number of bytes required to store the data</span>
<span class="sd">        in this table collection. Note that this may not be equal to</span>
<span class="sd">        the actual memory footprint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="mi">8</span><span class="p">,</span>  <span class="c1"># sequence_length takes 8 bytes</span>
                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_bytes</span><span class="p">),</span>
                <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metadata_schema</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">nbytes</span><span class="p">,</span>
                <span class="nb">sum</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">nbytes</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_map</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__banner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="n">width</span> <span class="o">=</span> <span class="mi">60</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="n">width</span>
        <span class="n">title_line</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;#   </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">title_line</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">title_line</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">title_line</span> <span class="o">+=</span> <span class="s2">&quot;#&quot;</span>
        <span class="k">return</span> <span class="n">line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">title_line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">line</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__banner</span><span class="p">(</span><span class="s2">&quot;Individuals&quot;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">individuals</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__banner</span><span class="p">(</span><span class="s2">&quot;Nodes&quot;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__banner</span><span class="p">(</span><span class="s2">&quot;Edges&quot;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__banner</span><span class="p">(</span><span class="s2">&quot;Sites&quot;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__banner</span><span class="p">(</span><span class="s2">&quot;Mutations&quot;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mutations</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__banner</span><span class="p">(</span><span class="s2">&quot;Migrations&quot;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">migrations</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__banner</span><span class="p">(</span><span class="s2">&quot;Populations&quot;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__banner</span><span class="p">(</span><span class="s2">&quot;Provenances&quot;</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">provenances</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>

<div class="viewcode-block" id="TableCollection.equals"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.equals">[docs]</a>    <span class="k">def</span> <span class="nf">equals</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">other</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">ignore_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ignore_ts_metadata</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ignore_provenance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ignore_timestamps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if  `self` and `other` are equal. By default, two table</span>
<span class="sd">        collections are considered equal if their</span>

<span class="sd">        - ``sequence_length`` properties are identical;</span>
<span class="sd">        - top-level tree sequence metadata and metadata schemas are</span>
<span class="sd">          byte-wise identical;</span>
<span class="sd">        - constituent tables are byte-wise identical.</span>

<span class="sd">        Some of the requirements in this definition can be relaxed using the</span>
<span class="sd">        parameters, which can be used to remove certain parts of the data model</span>
<span class="sd">        from the comparison.</span>

<span class="sd">        Table indexes are not considered in the equality comparison.</span>

<span class="sd">        :param TableCollection other: Another table collection.</span>
<span class="sd">        :param bool ignore_metadata: If True *all* metadata and metadata schemas</span>
<span class="sd">            will be excluded from the comparison. This includes the top-level</span>
<span class="sd">            tree sequence and constituent table metadata (default=False).</span>
<span class="sd">        :param bool ignore_ts_metadata: If True the top-level tree sequence</span>
<span class="sd">            metadata and metadata schemas will be excluded from the comparison.</span>
<span class="sd">            If ``ignore_metadata`` is True, this parameter has no effect.</span>
<span class="sd">        :param bool ignore_provenance: If True the provenance tables are</span>
<span class="sd">            not included in the comparison.</span>
<span class="sd">        :param bool ignore_timestamps: If True the provenance timestamp column</span>
<span class="sd">            is ignored in the comparison. If ``ignore_provenance`` is True, this</span>
<span class="sd">            parameter has no effect.</span>
<span class="sd">        :return: True if other is equal to this table collection; False otherwise.</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span>
                    <span class="n">other</span><span class="o">.</span><span class="n">_ll_tables</span><span class="p">,</span>
                    <span class="n">ignore_metadata</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">ignore_metadata</span><span class="p">),</span>
                    <span class="n">ignore_ts_metadata</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">ignore_ts_metadata</span><span class="p">),</span>
                    <span class="n">ignore_provenance</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">ignore_provenance</span><span class="p">),</span>
                    <span class="n">ignore_timestamps</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">ignore_timestamps</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">asdict</span><span class="p">()</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">file_or_path</span><span class="p">):</span>
        <span class="n">file</span><span class="p">,</span> <span class="n">local_file</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">convert_file_like_to_open_file</span><span class="p">(</span><span class="n">file_or_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
        <span class="n">ll_tc</span> <span class="o">=</span> <span class="n">_tskit</span><span class="o">.</span><span class="n">TableCollection</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ll_tc</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">tc</span> <span class="o">=</span> <span class="n">TableCollection</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">_ll_tables</span> <span class="o">=</span> <span class="n">ll_tc</span>
        <span class="k">return</span> <span class="n">tc</span>

<div class="viewcode-block" id="TableCollection.dump"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.dump">[docs]</a>    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_or_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Writes the table collection to the specified path or file object.</span>

<span class="sd">        :param str file_or_path: The file object or path to write the TreeSequence to.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">file</span><span class="p">,</span> <span class="n">local_file</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">convert_file_like_to_open_file</span><span class="p">(</span><span class="n">file_or_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">local_file</span><span class="p">:</span>
                <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="c1"># Unpickle support</span>
    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;sequence_length&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata_schema</span> <span class="o">=</span> <span class="n">tskit</span><span class="o">.</span><span class="n">parse_metadata_schema</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;metadata_schema&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata_schema</span><span class="o">.</span><span class="n">decode_row</span><span class="p">(</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">individuals</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;individuals&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">migrations</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;migrations&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutations</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;mutations&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">populations</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;populations&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">provenances</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">state</span><span class="p">[</span><span class="s2">&quot;provenances&quot;</span><span class="p">])</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">fromdict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tables_dict</span><span class="p">):</span>
        <span class="n">tables</span> <span class="o">=</span> <span class="n">TableCollection</span><span class="p">(</span><span class="n">tables_dict</span><span class="p">[</span><span class="s2">&quot;sequence_length&quot;</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tables</span><span class="o">.</span><span class="n">metadata_schema</span> <span class="o">=</span> <span class="n">tskit</span><span class="o">.</span><span class="n">parse_metadata_schema</span><span class="p">(</span>
                <span class="n">tables_dict</span><span class="p">[</span><span class="s2">&quot;metadata_schema&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tables</span><span class="o">.</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">metadata_schema</span><span class="o">.</span><span class="n">decode_row</span><span class="p">(</span><span class="n">tables_dict</span><span class="p">[</span><span class="s2">&quot;metadata&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">tables</span><span class="o">.</span><span class="n">individuals</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">tables_dict</span><span class="p">[</span><span class="s2">&quot;individuals&quot;</span><span class="p">])</span>
        <span class="n">tables</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">tables_dict</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">])</span>
        <span class="n">tables</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">tables_dict</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span>
        <span class="n">tables</span><span class="o">.</span><span class="n">migrations</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">tables_dict</span><span class="p">[</span><span class="s2">&quot;migrations&quot;</span><span class="p">])</span>
        <span class="n">tables</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">tables_dict</span><span class="p">[</span><span class="s2">&quot;sites&quot;</span><span class="p">])</span>
        <span class="n">tables</span><span class="o">.</span><span class="n">mutations</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">tables_dict</span><span class="p">[</span><span class="s2">&quot;mutations&quot;</span><span class="p">])</span>
        <span class="n">tables</span><span class="o">.</span><span class="n">populations</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">tables_dict</span><span class="p">[</span><span class="s2">&quot;populations&quot;</span><span class="p">])</span>
        <span class="n">tables</span><span class="o">.</span><span class="n">provenances</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span><span class="o">**</span><span class="n">tables_dict</span><span class="p">[</span><span class="s2">&quot;provenances&quot;</span><span class="p">])</span>

        <span class="c1"># Indexes must be last as other wise the check for their consistency will fail</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tables</span><span class="o">.</span><span class="n">indexes</span> <span class="o">=</span> <span class="n">TableCollectionIndexes</span><span class="p">(</span><span class="o">**</span><span class="n">tables_dict</span><span class="p">[</span><span class="s2">&quot;indexes&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">tables</span>

<div class="viewcode-block" id="TableCollection.copy"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a deep copy of this TableCollection.</span>

<span class="sd">        :return: A deep copy of this TableCollection.</span>
<span class="sd">        :rtype: .TableCollection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">TableCollection</span><span class="o">.</span><span class="n">fromdict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">asdict</span><span class="p">())</span></div>

<div class="viewcode-block" id="TableCollection.tree_sequence"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.tree_sequence">[docs]</a>    <span class="k">def</span> <span class="nf">tree_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a :class:`TreeSequence` instance with the structure defined by the</span>
<span class="sd">        tables in this :class:`TableCollection`. If the table collection is not</span>
<span class="sd">        in canonical form (i.e., does not meet sorting requirements) or cannot be</span>
<span class="sd">        interpreted as a tree sequence an exception is raised. The</span>
<span class="sd">        :meth:`.sort` method may be used to ensure that input sorting requirements</span>
<span class="sd">        are met. If the table collection does not have indexes they will be</span>
<span class="sd">        built.</span>

<span class="sd">        :return: A :class:`TreeSequence` instance reflecting the structures</span>
<span class="sd">            defined in this set of tables.</span>
<span class="sd">        :rtype: .TreeSequence</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_index</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">build_index</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">tskit</span><span class="o">.</span><span class="n">TreeSequence</span><span class="o">.</span><span class="n">load_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="TableCollection.simplify"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.simplify">[docs]</a>    <span class="k">def</span> <span class="nf">simplify</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">samples</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">reduce_to_site_topology</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">filter_populations</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">filter_individuals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">filter_sites</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">keep_unary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">keep_input_roots</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">record_provenance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">filter_zero_mutation_sites</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># Deprecated alias for filter_sites</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simplifies the tables in place to retain only the information necessary</span>
<span class="sd">        to reconstruct the tree sequence describing the given ``samples``.</span>
<span class="sd">        This will change the ID of the nodes, so that the node</span>
<span class="sd">        ``samples[k]`` will have ID ``k`` in the result. The resulting</span>
<span class="sd">        NodeTable will have only the first ``len(samples)`` individuals marked</span>
<span class="sd">        as samples. The mapping from node IDs in the current set of tables to</span>
<span class="sd">        their equivalent values in the simplified tables is also returned as a</span>
<span class="sd">        numpy array. If an array ``a`` is returned by this function and ``u``</span>
<span class="sd">        is the ID of a node in the input table, then ``a[u]`` is the ID of this</span>
<span class="sd">        node in the output table. For any node ``u`` that is not mapped into</span>
<span class="sd">        the output tables, this mapping will equal ``-1``.</span>

<span class="sd">        Tables operated on by this function must: be sorted (see</span>
<span class="sd">        :meth:`TableCollection.sort`), have children be born strictly after their</span>
<span class="sd">        parents, and the intervals on which any individual is a child must be</span>
<span class="sd">        disjoint. Other than this the tables need not satisfy remaining</span>
<span class="sd">        requirements to specify a valid tree sequence (but the resulting tables</span>
<span class="sd">        will).</span>

<span class="sd">        This is identical to :meth:`TreeSequence.simplify` but acts *in place* to</span>
<span class="sd">        alter the data in this :class:`TableCollection`. Please see the</span>
<span class="sd">        :meth:`TreeSequence.simplify` method for a description of the remaining</span>
<span class="sd">        parameters.</span>

<span class="sd">        :param list[int] samples: A list of node IDs to retain as samples. If</span>
<span class="sd">            not specified or None, use all nodes marked with the IS_SAMPLE flag.</span>
<span class="sd">        :param bool reduce_to_site_topology: Whether to reduce the topology down</span>
<span class="sd">            to the trees that are present at sites. (default: False).</span>
<span class="sd">        :param bool filter_populations: If True, remove any populations that are</span>
<span class="sd">            not referenced by nodes after simplification; new population IDs are</span>
<span class="sd">            allocated sequentially from zero. If False, the population table will</span>
<span class="sd">            not be altered in any way. (Default: True)</span>
<span class="sd">        :param bool filter_individuals: If True, remove any individuals that are</span>
<span class="sd">            not referenced by nodes after simplification; new individual IDs are</span>
<span class="sd">            allocated sequentially from zero. If False, the individual table will</span>
<span class="sd">            not be altered in any way. (Default: True)</span>
<span class="sd">        :param bool filter_sites: If True, remove any sites that are</span>
<span class="sd">            not referenced by mutations after simplification; new site IDs are</span>
<span class="sd">            allocated sequentially from zero. If False, the site table will not</span>
<span class="sd">            be altered in any way. (Default: True)</span>
<span class="sd">        :param bool keep_unary: If True, any unary nodes (i.e. nodes with exactly</span>
<span class="sd">            one child) that exist on the path from samples to root will be preserved</span>
<span class="sd">            in the output. (Default: False)</span>
<span class="sd">        :param bool keep_input_roots: If True, insert edges from the MRCAs of the</span>
<span class="sd">            samples to the roots in the input trees. If False, no topology older</span>
<span class="sd">            than the MRCAs of the samples will be included. (Default: False)</span>
<span class="sd">        :param bool record_provenance: If True, record details of this call to</span>
<span class="sd">            simplify in the returned tree sequence&#39;s provenance information</span>
<span class="sd">            (Default: True).</span>
<span class="sd">        :param bool filter_zero_mutation_sites: Deprecated alias for ``filter_sites``.</span>
<span class="sd">        :return: A numpy array mapping node IDs in the input tables to their</span>
<span class="sd">            corresponding node IDs in the output tables.</span>
<span class="sd">        :rtype: numpy.ndarray (dtype=np.int32)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filter_zero_mutation_sites</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Deprecated in msprime 0.6.1.</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;filter_zero_mutation_sites is deprecated; use filter_sites instead&quot;</span><span class="p">,</span>
                <span class="ne">FutureWarning</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">filter_sites</span> <span class="o">=</span> <span class="n">filter_zero_mutation_sites</span>
        <span class="k">if</span> <span class="n">samples</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">flags</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bitwise_and</span><span class="p">(</span><span class="n">flags</span><span class="p">,</span> <span class="n">_tskit</span><span class="o">.</span><span class="n">NODE_IS_SAMPLE</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)[</span>
                <span class="mi">0</span>
            <span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">safe_np_int_cast</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">node_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span>
            <span class="n">samples</span><span class="p">,</span>
            <span class="n">filter_sites</span><span class="o">=</span><span class="n">filter_sites</span><span class="p">,</span>
            <span class="n">filter_individuals</span><span class="o">=</span><span class="n">filter_individuals</span><span class="p">,</span>
            <span class="n">filter_populations</span><span class="o">=</span><span class="n">filter_populations</span><span class="p">,</span>
            <span class="n">reduce_to_site_topology</span><span class="o">=</span><span class="n">reduce_to_site_topology</span><span class="p">,</span>
            <span class="n">keep_unary</span><span class="o">=</span><span class="n">keep_unary</span><span class="p">,</span>
            <span class="n">keep_input_roots</span><span class="o">=</span><span class="n">keep_input_roots</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">record_provenance</span><span class="p">:</span>
            <span class="c1"># TODO replace with a version of https://github.com/tskit-dev/tskit/pull/243</span>
            <span class="c1"># TODO also make sure we convert all the arguments so that they are</span>
            <span class="c1"># definitely JSON encodable.</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;simplify&quot;</span><span class="p">,</span> <span class="s2">&quot;TODO&quot;</span><span class="p">:</span> <span class="s2">&quot;add simplify parameters&quot;</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">provenances</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
                <span class="n">record</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">provenance</span><span class="o">.</span><span class="n">get_provenance_dict</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">node_map</span></div>

<div class="viewcode-block" id="TableCollection.link_ancestors"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.link_ancestors">[docs]</a>    <span class="k">def</span> <span class="nf">link_ancestors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">ancestors</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns an :class:`EdgeTable` instance describing a subset of the genealogical</span>
<span class="sd">        relationships between the nodes in ``samples`` and ``ancestors``.</span>

<span class="sd">        Each row ``parent, child, left, right`` in the output table indicates that</span>
<span class="sd">        ``child`` has inherited the segment ``[left, right)`` from ``parent`` more</span>
<span class="sd">        recently than from any other node in these lists.</span>

<span class="sd">        In particular, suppose ``samples`` is a list of nodes such that ``time`` is 0</span>
<span class="sd">        for each node, and ``ancestors`` is a list of nodes such that ``time`` is</span>
<span class="sd">        greater than 0.0 for each node. Then each row of the output table will show</span>
<span class="sd">        an interval ``[left, right)`` over which a node in ``samples`` has inherited</span>
<span class="sd">        most recently from a node in ``ancestors``, or an interval over which one of</span>
<span class="sd">        these ``ancestors`` has inherited most recently from another node in</span>
<span class="sd">        ``ancestors``.</span>

<span class="sd">        The following table shows which ``parent-&gt;child`` pairs will be shown in the</span>
<span class="sd">        output of ``link_ancestors``.</span>
<span class="sd">        A node is a relevant descendant on a given interval if it also appears somewhere</span>
<span class="sd">        in the ``parent`` column of the outputted table.</span>

<span class="sd">        ========================  ===============================================</span>
<span class="sd">        Type of relationship      Shown in output of ``link_ancestors``</span>
<span class="sd">        ------------------------  -----------------------------------------------</span>
<span class="sd">        ``ancestor-&gt;sample``      Always</span>
<span class="sd">        ``ancestor1-&gt;ancestor2``  Only if ``ancestor2`` has a relevant descendant</span>
<span class="sd">        ``sample1-&gt;sample2``      Always</span>
<span class="sd">        ``sample-&gt;ancestor``      Only if ``ancestor`` has a relevant descendant</span>
<span class="sd">        ========================  ===============================================</span>

<span class="sd">        The difference between ``samples`` and ``ancestors`` is that information about</span>
<span class="sd">        the ancestors of a node in ``ancestors`` will only be retained if it also has a</span>
<span class="sd">        relevant descendant, while information about the ancestors of a node in</span>
<span class="sd">        ``samples`` will always be retained.</span>
<span class="sd">        The node IDs in ``parent`` and ``child`` refer to the IDs in the node table</span>
<span class="sd">        of the inputted tree sequence.</span>

<span class="sd">        The supplied nodes must be non-empty lists of the node IDs in the tree sequence:</span>
<span class="sd">        in particular, they do not have to be *samples* of the tree sequence. The lists</span>
<span class="sd">        of ``samples`` and ``ancestors`` may overlap, although adding a node from</span>
<span class="sd">        ``samples`` to ``ancestors`` will not change the output. So, setting ``samples``</span>
<span class="sd">        and ``ancestors`` to the same list of nodes will find all genealogical</span>
<span class="sd">        relationships within this list.</span>

<span class="sd">        If none of the nodes in ``ancestors`` or ``samples`` are ancestral to ``samples``</span>
<span class="sd">        anywhere in the tree sequence, an empty table will be returned.</span>

<span class="sd">        :param list[int] samples: A list of node IDs to retain as samples.</span>
<span class="sd">        :param list[int] ancestors: A list of node IDs to use as ancestors.</span>
<span class="sd">        :return: An :class:`EdgeTable` instance displaying relationships between</span>
<span class="sd">            the `samples` and `ancestors`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">safe_np_int_cast</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">ancestors</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">safe_np_int_cast</span><span class="p">(</span><span class="n">ancestors</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="n">ll_edge_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">link_ancestors</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">ancestors</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">EdgeTable</span><span class="p">(</span><span class="n">ll_table</span><span class="o">=</span><span class="n">ll_edge_table</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">map_ancestors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># A deprecated alias for link_ancestors()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_ancestors</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="TableCollection.sort"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.sort">[docs]</a>    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge_start</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sorts the tables in place. This ensures that all tree sequence ordering</span>
<span class="sd">        requirements listed in the</span>
<span class="sd">        :ref:`sec_valid_tree_sequence_requirements` section are met, as long</span>
<span class="sd">        as each site has at most one mutation (see below).</span>

<span class="sd">        If the ``edge_start`` parameter is provided, this specifies the index</span>
<span class="sd">        in the edge table where sorting should start. Only rows with index</span>
<span class="sd">        greater than or equal to ``edge_start`` are sorted; rows before this index</span>
<span class="sd">        are not affected. This parameter is provided to allow for efficient sorting</span>
<span class="sd">        when the user knows that the edges up to a given index are already sorted.</span>

<span class="sd">        The individual, node, population and provenance tables are not affected</span>
<span class="sd">        by this method.</span>

<span class="sd">        Edges are sorted as follows:</span>

<span class="sd">        - time of parent, then</span>
<span class="sd">        - parent node ID, then</span>
<span class="sd">        - child node ID, then</span>
<span class="sd">        - left endpoint.</span>

<span class="sd">        Note that this sorting order exceeds the</span>
<span class="sd">        :ref:`edge sorting requirements &lt;sec_edge_requirements&gt;` for a valid</span>
<span class="sd">        tree sequence. For a valid tree sequence, we require that all edges for a</span>
<span class="sd">        given parent ID are adjacent, but we do not require that they be listed in</span>
<span class="sd">        sorted order.</span>

<span class="sd">        Sites are sorted by position, and sites with the same position retain</span>
<span class="sd">        their relative ordering.</span>

<span class="sd">        Mutations are sorted by site ID, and within the same site are sorted by time.</span>
<span class="sd">        Those with equal or unknown time retain their relative ordering. This does not</span>
<span class="sd">        currently rearrange tables so that mutations occur after their mutation parents,</span>
<span class="sd">        which is a requirement for valid tree sequences.</span>

<span class="sd">        :param int edge_start: The index in the edge table where sorting starts</span>
<span class="sd">            (default=0; must be &lt;= len(edges)).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">edge_start</span><span class="p">)</span></div>
        <span class="c1"># TODO add provenance</span>

<div class="viewcode-block" id="TableCollection.compute_mutation_parents"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.compute_mutation_parents">[docs]</a>    <span class="k">def</span> <span class="nf">compute_mutation_parents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modifies the tables in place, computing the ``parent`` column of the</span>
<span class="sd">        mutation table. For this to work, the node and edge tables must be</span>
<span class="sd">        valid, and the site and mutation tables must be sorted (see</span>
<span class="sd">        :meth:`TableCollection.sort`).  This will produce an error if mutations</span>
<span class="sd">        are not sorted (i.e., if a mutation appears before its mutation parent)</span>
<span class="sd">        *unless* the two mutations occur on the same branch, in which case</span>
<span class="sd">        there is no way to detect the error.</span>

<span class="sd">        The ``parent`` of a given mutation is the ID of the next mutation</span>
<span class="sd">        encountered traversing the tree upwards from that mutation, or</span>
<span class="sd">        ``NULL`` if there is no such mutation.</span>

<span class="sd">        .. note:: note: This method does not check that all mutations result</span>
<span class="sd">            in a change of state, as required; see :ref:`sec_mutation_requirements`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">compute_mutation_parents</span><span class="p">()</span></div>
        <span class="c1"># TODO add provenance</span>

<div class="viewcode-block" id="TableCollection.compute_mutation_times"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.compute_mutation_times">[docs]</a>    <span class="k">def</span> <span class="nf">compute_mutation_times</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modifies the tables in place, computing valid values for the ``time`` column of</span>
<span class="sd">        the mutation table. For this to work, the node and edge tables must be</span>
<span class="sd">        valid, and the site and mutation tables must be sorted and indexed(see</span>
<span class="sd">        :meth:`TableCollection.sort` and :meth:`TableCollection.build_index`).</span>

<span class="sd">        For a single mutation on an edge at a site, the ``time`` assigned to a mutation</span>
<span class="sd">        by this method is the mid-point between the times of the nodes above and below</span>
<span class="sd">        the mutation. In the case where there is more than one mutation on an edge for</span>
<span class="sd">        a site, the times are evenly spread along the edge. For mutations that are</span>
<span class="sd">        above a root node, the time of the root node is assigned.</span>

<span class="sd">        The mutation table will be sorted if the new times mean that the original order</span>
<span class="sd">        is no longer valid.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">compute_mutation_times</span><span class="p">()</span></div>
        <span class="c1"># TODO add provenance</span>

<div class="viewcode-block" id="TableCollection.deduplicate_sites"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.deduplicate_sites">[docs]</a>    <span class="k">def</span> <span class="nf">deduplicate_sites</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modifies the tables in place, removing entries in the site table with</span>
<span class="sd">        duplicate ``position`` (and keeping only the *first* entry for each</span>
<span class="sd">        site), and renumbering the ``site`` column of the mutation table</span>
<span class="sd">        appropriately.  This requires the site table to be sorted by position.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">deduplicate_sites</span><span class="p">()</span></div>
        <span class="c1"># TODO add provenance</span>

<div class="viewcode-block" id="TableCollection.delete_sites"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.delete_sites">[docs]</a>    <span class="k">def</span> <span class="nf">delete_sites</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">site_ids</span><span class="p">,</span> <span class="n">record_provenance</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove the specified sites entirely from the sites and mutations tables in this</span>
<span class="sd">        collection. This is identical to :meth:`TreeSequence.delete_sites` but acts</span>
<span class="sd">        *in place* to alter the data in this :class:`TableCollection`.</span>

<span class="sd">        :param list[int] site_ids: A list of site IDs specifying the sites to remove.</span>
<span class="sd">        :param bool record_provenance: If ``True``, add details of this operation</span>
<span class="sd">            to the provenance table in this TableCollection. (Default: ``True``).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keep_sites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">site_ids</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">safe_np_int_cast</span><span class="p">(</span><span class="n">site_ids</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">site_ids</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">site_ids</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Site ID out of bounds&quot;</span><span class="p">)</span>
        <span class="n">keep_sites</span><span class="p">[</span><span class="n">site_ids</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">new_as</span><span class="p">,</span> <span class="n">new_as_offset</span> <span class="o">=</span> <span class="n">keep_with_offset</span><span class="p">(</span>
            <span class="n">keep_sites</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">ancestral_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">ancestral_state_offset</span>
        <span class="p">)</span>
        <span class="n">new_md</span><span class="p">,</span> <span class="n">new_md_offset</span> <span class="o">=</span> <span class="n">keep_with_offset</span><span class="p">(</span>
            <span class="n">keep_sites</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">metadata_offset</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span>
            <span class="n">position</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="n">keep_sites</span><span class="p">],</span>
            <span class="n">ancestral_state</span><span class="o">=</span><span class="n">new_as</span><span class="p">,</span>
            <span class="n">ancestral_state_offset</span><span class="o">=</span><span class="n">new_as_offset</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">new_md</span><span class="p">,</span>
            <span class="n">metadata_offset</span><span class="o">=</span><span class="n">new_md_offset</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># We also need to adjust the mutations table, as it references into sites</span>
        <span class="n">keep_mutations</span> <span class="o">=</span> <span class="n">keep_sites</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mutations</span><span class="o">.</span><span class="n">site</span><span class="p">]</span>
        <span class="n">new_ds</span><span class="p">,</span> <span class="n">new_ds_offset</span> <span class="o">=</span> <span class="n">keep_with_offset</span><span class="p">(</span>
            <span class="n">keep_mutations</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mutations</span><span class="o">.</span><span class="n">derived_state</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mutations</span><span class="o">.</span><span class="n">derived_state_offset</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">new_md</span><span class="p">,</span> <span class="n">new_md_offset</span> <span class="o">=</span> <span class="n">keep_with_offset</span><span class="p">(</span>
            <span class="n">keep_mutations</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutations</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutations</span><span class="o">.</span><span class="n">metadata_offset</span>
        <span class="p">)</span>
        <span class="c1"># Site numbers will have changed</span>
        <span class="n">site_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">keep_sites</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutations</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="c1"># Mutation numbers will change, so the parent references need altering</span>
        <span class="n">mutation_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">keep_mutations</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutations</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="c1"># Map parent == -1 to -1, and check this has worked (assumes tskit.NULL == -1)</span>
        <span class="n">mutation_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mutation_map</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mutations</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">mutation_map</span><span class="p">[</span><span class="n">tskit</span><span class="o">.</span><span class="n">NULL</span><span class="p">]</span> <span class="o">==</span> <span class="n">tskit</span><span class="o">.</span><span class="n">NULL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutations</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span>
            <span class="n">site</span><span class="o">=</span><span class="n">site_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mutations</span><span class="o">.</span><span class="n">site</span><span class="p">[</span><span class="n">keep_mutations</span><span class="p">]],</span>
            <span class="n">node</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutations</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">keep_mutations</span><span class="p">],</span>
            <span class="n">time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mutations</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">keep_mutations</span><span class="p">],</span>
            <span class="n">derived_state</span><span class="o">=</span><span class="n">new_ds</span><span class="p">,</span>
            <span class="n">derived_state_offset</span><span class="o">=</span><span class="n">new_ds_offset</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">mutation_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mutations</span><span class="o">.</span><span class="n">parent</span><span class="p">[</span><span class="n">keep_mutations</span><span class="p">]],</span>
            <span class="n">metadata</span><span class="o">=</span><span class="n">new_md</span><span class="p">,</span>
            <span class="n">metadata_offset</span><span class="o">=</span><span class="n">new_md_offset</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">record_provenance</span><span class="p">:</span>
            <span class="c1"># TODO replace with a version of https://github.com/tskit-dev/tskit/pull/243</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;delete_sites&quot;</span><span class="p">,</span> <span class="s2">&quot;TODO&quot;</span><span class="p">:</span> <span class="s2">&quot;add parameters&quot;</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">provenances</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
                <span class="n">record</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">provenance</span><span class="o">.</span><span class="n">get_provenance_dict</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="TableCollection.delete_intervals"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.delete_intervals">[docs]</a>    <span class="k">def</span> <span class="nf">delete_intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intervals</span><span class="p">,</span> <span class="n">simplify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">record_provenance</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete all information from this set of tables which lies *within* the</span>
<span class="sd">        specified list of genomic intervals. This is identical to</span>
<span class="sd">        :meth:`TreeSequence.delete_intervals` but acts *in place* to alter</span>
<span class="sd">        the data in this :class:`TableCollection`.</span>

<span class="sd">        :param array_like intervals: A list (start, end) pairs describing the</span>
<span class="sd">            genomic intervals to delete. Intervals must be non-overlapping and</span>
<span class="sd">            in increasing order. The list of intervals must be interpretable as a</span>
<span class="sd">            2D numpy array with shape (N, 2), where N is the number of intervals.</span>
<span class="sd">        :param bool simplify: If True, run simplify on the tables so that nodes</span>
<span class="sd">            no longer used are discarded. (Default: True).</span>
<span class="sd">        :param bool record_provenance: If ``True``, add details of this operation</span>
<span class="sd">            to the provenance table in this TableCollection. (Default: ``True``).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_intervals</span><span class="p">(</span>
            <span class="n">util</span><span class="o">.</span><span class="n">negate_intervals</span><span class="p">(</span><span class="n">intervals</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence_length</span><span class="p">),</span>
            <span class="n">simplify</span><span class="o">=</span><span class="n">simplify</span><span class="p">,</span>
            <span class="n">record_provenance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">record_provenance</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;delete_intervals&quot;</span><span class="p">,</span> <span class="s2">&quot;TODO&quot;</span><span class="p">:</span> <span class="s2">&quot;add parameters&quot;</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">provenances</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
                <span class="n">record</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">provenance</span><span class="o">.</span><span class="n">get_provenance_dict</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="TableCollection.keep_intervals"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.keep_intervals">[docs]</a>    <span class="k">def</span> <span class="nf">keep_intervals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intervals</span><span class="p">,</span> <span class="n">simplify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">record_provenance</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete all information from this set of tables which lies *outside* the</span>
<span class="sd">        specified list of genomic intervals. This is identical to</span>
<span class="sd">        :meth:`TreeSequence.keep_intervals` but acts *in place* to alter</span>
<span class="sd">        the data in this :class:`TableCollection`.</span>

<span class="sd">        :param array_like intervals: A list (start, end) pairs describing the</span>
<span class="sd">            genomic intervals to keep. Intervals must be non-overlapping and</span>
<span class="sd">            in increasing order. The list of intervals must be interpretable as a</span>
<span class="sd">            2D numpy array with shape (N, 2), where N is the number of intervals.</span>
<span class="sd">        :param bool simplify: If True, run simplify on the tables so that nodes</span>
<span class="sd">            no longer used are discarded. (Default: True).</span>
<span class="sd">        :param bool record_provenance: If ``True``, add details of this operation</span>
<span class="sd">            to the provenance table in this TableCollection. (Default: ``True``).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">intervals</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">intervals_to_np_array</span><span class="p">(</span><span class="n">intervals</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence_length</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">migrations</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Migrations not supported by keep_ and delete_ intervals&quot;</span><span class="p">)</span>

        <span class="n">edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">keep_sites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">num_rows</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">intervals</span><span class="p">:</span>
            <span class="n">curr_keep_sites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">position</span> <span class="o">&gt;=</span> <span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">position</span> <span class="o">&lt;</span> <span class="n">e</span>
            <span class="p">)</span>
            <span class="n">keep_sites</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">keep_sites</span><span class="p">,</span> <span class="n">curr_keep_sites</span><span class="p">)</span>
            <span class="n">keep_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">edges</span><span class="o">.</span><span class="n">right</span> <span class="o">&lt;=</span> <span class="n">s</span><span class="p">,</span> <span class="n">edges</span><span class="o">.</span><span class="n">left</span> <span class="o">&gt;=</span> <span class="n">e</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">append_columns</span><span class="p">(</span>
                <span class="n">left</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fmax</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">edges</span><span class="o">.</span><span class="n">left</span><span class="p">[</span><span class="n">keep_edges</span><span class="p">]),</span>
                <span class="n">right</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fmin</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">edges</span><span class="o">.</span><span class="n">right</span><span class="p">[</span><span class="n">keep_edges</span><span class="p">]),</span>
                <span class="n">parent</span><span class="o">=</span><span class="n">edges</span><span class="o">.</span><span class="n">parent</span><span class="p">[</span><span class="n">keep_edges</span><span class="p">],</span>
                <span class="n">child</span><span class="o">=</span><span class="n">edges</span><span class="o">.</span><span class="n">child</span><span class="p">[</span><span class="n">keep_edges</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_sites</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">keep_sites</span><span class="p">))[</span><span class="mi">0</span><span class="p">],</span> <span class="n">record_provenance</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">simplify</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">record_provenance</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">record_provenance</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;keep_intervals&quot;</span><span class="p">,</span> <span class="s2">&quot;TODO&quot;</span><span class="p">:</span> <span class="s2">&quot;add parameters&quot;</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">provenances</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
                <span class="n">record</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">provenance</span><span class="o">.</span><span class="n">get_provenance_dict</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
            <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_check_trim_conditions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">migrations</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You cannot trim a tree sequence containing migrations&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">num_rows</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Trimming a tree sequence with no edges would reduce the sequence length&quot;</span>
                <span class="s2">&quot; to zero, which is not allowed&quot;</span>
            <span class="p">)</span>

<div class="viewcode-block" id="TableCollection.ltrim"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.ltrim">[docs]</a>    <span class="k">def</span> <span class="nf">ltrim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record_provenance</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset the coordinate system used in these tables, changing the left and right</span>
<span class="sd">        genomic positions in the edge table such that the leftmost edge now starts at</span>
<span class="sd">        position 0. This is identical to :meth:`TreeSequence.ltrim` but acts *in place*</span>
<span class="sd">        to alter the data in this :class:`TableCollection`.</span>

<span class="sd">        :param bool record_provenance: If ``True``, add details of this operation</span>
<span class="sd">            to the provenance table in this TableCollection. (Default: ``True``).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_trim_conditions</span><span class="p">()</span>
        <span class="n">leftmost</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_sites</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">position</span> <span class="o">&lt;</span> <span class="n">leftmost</span><span class="p">),</span> <span class="n">record_provenance</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span>
            <span class="n">left</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">left</span> <span class="o">-</span> <span class="n">leftmost</span><span class="p">,</span>
            <span class="n">right</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">right</span> <span class="o">-</span> <span class="n">leftmost</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
            <span class="n">child</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">child</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">set_columns</span><span class="p">(</span>
            <span class="n">position</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">leftmost</span><span class="p">,</span>
            <span class="n">ancestral_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">ancestral_state</span><span class="p">,</span>
            <span class="n">ancestral_state_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">ancestral_state_offset</span><span class="p">,</span>
            <span class="n">metadata</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">metadata</span><span class="p">,</span>
            <span class="n">metadata_offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">metadata_offset</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequence_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence_length</span> <span class="o">-</span> <span class="n">leftmost</span>
        <span class="k">if</span> <span class="n">record_provenance</span><span class="p">:</span>
            <span class="c1"># TODO replace with a version of https://github.com/tskit-dev/tskit/pull/243</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;ltrim&quot;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">provenances</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
                <span class="n">record</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">provenance</span><span class="o">.</span><span class="n">get_provenance_dict</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="TableCollection.rtrim"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.rtrim">[docs]</a>    <span class="k">def</span> <span class="nf">rtrim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record_provenance</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset the ``sequence_length`` property so that the sequence ends at the end of</span>
<span class="sd">        the last edge. This is identical to :meth:`TreeSequence.rtrim` but acts</span>
<span class="sd">        *in place* to alter the data in this :class:`TableCollection`.</span>

<span class="sd">        :param bool record_provenance: If ``True``, add details of this operation</span>
<span class="sd">            to the provenance table in this TableCollection. (Default: ``True``).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_trim_conditions</span><span class="p">()</span>
        <span class="n">rightmost</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edges</span><span class="o">.</span><span class="n">right</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_sites</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sites</span><span class="o">.</span><span class="n">position</span> <span class="o">&gt;=</span> <span class="n">rightmost</span><span class="p">),</span> <span class="n">record_provenance</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequence_length</span> <span class="o">=</span> <span class="n">rightmost</span>
        <span class="k">if</span> <span class="n">record_provenance</span><span class="p">:</span>
            <span class="c1"># TODO replace with a version of https://github.com/tskit-dev/tskit/pull/243</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;rtrim&quot;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">provenances</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
                <span class="n">record</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">provenance</span><span class="o">.</span><span class="n">get_provenance_dict</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="TableCollection.trim"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.trim">[docs]</a>    <span class="k">def</span> <span class="nf">trim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record_provenance</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trim away any empty regions on the right and left of the tree sequence encoded by</span>
<span class="sd">        these tables. This is identical to :meth:`TreeSequence.trim` but acts *in place*</span>
<span class="sd">        to alter the data in this :class:`TableCollection`.</span>

<span class="sd">        :param bool record_provenance: If ``True``, add details of this operation</span>
<span class="sd">            to the provenance table in this TableCollection. (Default: ``True``).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rtrim</span><span class="p">(</span><span class="n">record_provenance</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ltrim</span><span class="p">(</span><span class="n">record_provenance</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">record_provenance</span><span class="p">:</span>
            <span class="c1"># TODO replace with a version of https://github.com/tskit-dev/tskit/pull/243</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;trim&quot;</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">provenances</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
                <span class="n">record</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">provenance</span><span class="o">.</span><span class="n">get_provenance_dict</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="TableCollection.clear"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">clear_provenance</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">clear_metadata_schemas</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">clear_ts_metadata_and_schema</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove all rows of the data tables, optionally remove provenance, metadata</span>
<span class="sd">        schemas and ts-level metadata.</span>

<span class="sd">        :param bool clear_provenance: If ``True``, remove all rows of the provenance</span>
<span class="sd">            table. (Default: ``False``).</span>
<span class="sd">        :param bool clear_metadata_schemas: If ``True``, clear the table metadata</span>
<span class="sd">            schemas. (Default: ``False``).</span>
<span class="sd">        :param bool clear_ts_metadata_and_schema: If ``True``, clear the tree-sequence</span>
<span class="sd">            level metadata and schema (Default: ``False``).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span>
            <span class="n">clear_provenance</span><span class="o">=</span><span class="n">clear_provenance</span><span class="p">,</span>
            <span class="n">clear_metadata_schemas</span><span class="o">=</span><span class="n">clear_metadata_schemas</span><span class="p">,</span>
            <span class="n">clear_ts_metadata_and_schema</span><span class="o">=</span><span class="n">clear_ts_metadata_and_schema</span><span class="p">,</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="TableCollection.has_index"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.has_index">[docs]</a>    <span class="k">def</span> <span class="nf">has_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns True if this TableCollection is indexed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">has_index</span><span class="p">())</span></div>

<div class="viewcode-block" id="TableCollection.build_index"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.build_index">[docs]</a>    <span class="k">def</span> <span class="nf">build_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds an index on this TableCollection. Any existing indexes are automatically</span>
<span class="sd">        dropped.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">build_index</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableCollection.drop_index"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.drop_index">[docs]</a>    <span class="k">def</span> <span class="nf">drop_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Drops any indexes present on this table collection. If the tables are not</span>
<span class="sd">        currently indexed this method has no effect.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">drop_index</span><span class="p">()</span></div>

<div class="viewcode-block" id="TableCollection.subset"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.subset">[docs]</a>    <span class="k">def</span> <span class="nf">subset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">record_provenance</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modifies the tables in place to contain only the entries referring to</span>
<span class="sd">        the provided list of nodes, with nodes reordered according to the order</span>
<span class="sd">        they appear in the list. See :meth:`TreeSequence.subset` for a more</span>
<span class="sd">        detailed description.</span>

<span class="sd">        :param list nodes: The list of nodes for which to retain information. This</span>
<span class="sd">            may be a numpy array (or array-like) object (dtype=np.int32).</span>
<span class="sd">        :param bool record_provenance: Whether to record a provenance entry</span>
<span class="sd">            in the provenance table for this operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">safe_np_int_cast</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">subset</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">record_provenance</span><span class="p">:</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;subset&quot;</span><span class="p">,</span> <span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="n">nodes</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">provenances</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
                <span class="n">record</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">provenance</span><span class="o">.</span><span class="n">get_provenance_dict</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="TableCollection.union"><a class="viewcode-back" href="../../python-api.html#tskit.TableCollection.union">[docs]</a>    <span class="k">def</span> <span class="nf">union</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">other</span><span class="p">,</span>
        <span class="n">node_mapping</span><span class="p">,</span>
        <span class="n">check_shared_equality</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">add_populations</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">record_provenance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modifies the table collection in place by adding the non-shared</span>
<span class="sd">        portions of ``other`` to itself. To perform the node-wise union,</span>
<span class="sd">        the method relies on a ``node_mapping`` array, that maps nodes in</span>
<span class="sd">        ``other`` to its equivalent node in ``self`` or ``tskit.NULL`` if</span>
<span class="sd">        the node is exclusive to ``other``. See :meth:`TreeSequence.union` for a more</span>
<span class="sd">        detailed description.</span>

<span class="sd">        :param TableCollection other: Another table collection.</span>
<span class="sd">        :param list node_mapping: An array of node IDs that relate nodes in</span>
<span class="sd">            ``other`` to nodes in ``self``: the k-th element of ``node_mapping``</span>
<span class="sd">            should be the index of the equivalent node in ``self``, or</span>
<span class="sd">            ``tskit.NULL`` if the node is not present in ``self`` (in which case it</span>
<span class="sd">            will be added to self).</span>
<span class="sd">        :param bool check_shared_equality: If True, the shared portions of the</span>
<span class="sd">            table collections will be checked for equality.</span>
<span class="sd">        :param bool add_populations: If True, nodes new to ``self`` will be</span>
<span class="sd">            assigned new population IDs.</span>
<span class="sd">        :param bool record_provenance: Whether to record a provenance entry</span>
<span class="sd">            in the provenance table for this operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_mapping</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">safe_np_int_cast</span><span class="p">(</span><span class="n">node_mapping</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">union</span><span class="p">(</span>
            <span class="n">other</span><span class="o">.</span><span class="n">_ll_tables</span><span class="p">,</span>
            <span class="n">node_mapping</span><span class="p">,</span>
            <span class="n">check_shared_equality</span><span class="o">=</span><span class="n">check_shared_equality</span><span class="p">,</span>
            <span class="n">add_populations</span><span class="o">=</span><span class="n">add_populations</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">record_provenance</span><span class="p">:</span>
            <span class="n">other_records</span> <span class="o">=</span> <span class="p">[</span><span class="n">prov</span><span class="o">.</span><span class="n">record</span> <span class="k">for</span> <span class="n">prov</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">provenances</span><span class="p">]</span>
            <span class="n">other_timestamps</span> <span class="o">=</span> <span class="p">[</span><span class="n">prov</span><span class="o">.</span><span class="n">timestamp</span> <span class="k">for</span> <span class="n">prov</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">provenances</span><span class="p">]</span>
            <span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;command&quot;</span><span class="p">:</span> <span class="s2">&quot;union&quot;</span><span class="p">,</span>
                <span class="s2">&quot;other&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">other_timestamps</span><span class="p">,</span> <span class="s2">&quot;record&quot;</span><span class="p">:</span> <span class="n">other_records</span><span class="p">},</span>
                <span class="s2">&quot;node_mapping&quot;</span><span class="p">:</span> <span class="n">node_mapping</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">provenances</span><span class="o">.</span><span class="n">add_row</span><span class="p">(</span>
                <span class="n">record</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">provenance</span><span class="o">.</span><span class="n">get_provenance_dict</span><span class="p">(</span><span class="n">parameters</span><span class="p">))</span>
            <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">find_ibd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samples</span><span class="p">,</span> <span class="n">max_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">max_time</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">float_info</span><span class="o">.</span><span class="n">max</span> <span class="k">if</span> <span class="n">max_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">max_time</span>
        <span class="n">min_length</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">min_length</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">min_length</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ll_tables</span><span class="o">.</span><span class="n">find_ibd</span><span class="p">(</span>
            <span class="n">samples</span><span class="p">,</span> <span class="n">max_time</span><span class="o">=</span><span class="n">max_time</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="n">min_length</span>
        <span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2018-2020, Tskit developers

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>